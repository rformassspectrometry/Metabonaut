<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Large Scale Data Preprocessing with xcms • Metabonaut</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Large Scale Data Preprocessing with xcms">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Metabonaut</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/install_v0.html">Installation instructions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-workflows" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Workflows</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-workflows">
<li><a class="dropdown-item" href="../articles/a-end-to-end-untargeted-metabolomics.html">End-to-end workflow for untargeted metabolomics data analysis in R</a></li>
    <li><a class="dropdown-item" href="../articles/dataset-investigation.html">Dataset investigation: What to do when you get your data</a></li>
    <li><a class="dropdown-item" href="../articles/alignment-to-external-dataset.html">Seamless Alignment: Merging New data with Existing Preprocessed Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/SpectriPy-tutorial-metabonaut.html">LC-MS/MS Data Annotation using R and Python</a></li>
    <li><a class="dropdown-item" href="../articles/large-scale-analysis.html">Large Scale Data Preprocessing with xcms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rformassspectrometry/Metabonaut/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Large Scale Data Preprocessing with xcms</h1>
                        <h4 data-toc-skip class="author">Johannes
Rainer</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/rformassspectrometry/Metabonaut/blob/devel/vignettes/large-scale-analysis.Rmd" class="external-link"><code>vignettes/large-scale-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>large-scale-analysis.Rmd</code></div>
    </div>

    
    
<!--
# Pre-render with (in the vignettes folder)
knitr::knit("large-scale-analysis.Rmd.orig", output = "large-scale-analysis.Rmd")
-->
<p><strong>Note</strong>: this vignette is <a href="https://ropensci.org/blog/2019/12/08/precompute-vignettes/" class="external-link"><strong>pre-computed</strong></a>.
See the session info for information on packages used and the date the
vignette was rendered. The vignette is completely reproducible and can
be run and evaluated locally. The full MS data is available in the
MetaboLights repository and is downloaded and cached as part of this
vignette. Thus, to run the code locally about 800GB of free disk space
is required.</p>
<p><strong>Note</strong>: the memory-saving functionality used in this
document requires <em>xcms</em> version &gt;= 3.7.1 which is currently
(April 2025) available in Bioconductor’s 3.22 developmental branch. It
can be installed from GitHub using
<code>remotes::install_github("sneumann/xcms")</code>.</p>
<p><strong>Information on computational setup</strong>: this vignette
was rendered on a Notebook with an 13th Gen Intel(R) Core(TM) i7-1370P
CPU and 64GB of main memory.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>By design, <em>xcms</em> supports preprocessing of large scale data
even with over 10,000 samples/data files. Handling the results of such
experiments is however non-trivial and can require a very large amount
of main memory. Recent updates to <em>xcms</em>, which include full
support of the MS data infrastructure provided by the <em>Spectra</em>
package as well as a new <em>on-disk</em> storage mode for preprocessing
results, further reduce <em>xcms</em>’ memory demand and hence enable
memory-saving large scale data processing also on regular computer
setups. In this document a large public metabolomics data set with about
4,000 data files is analyzed and <em>xcms</em>’ memory usage and
performance tracked. Performance and memory usage for different
configurations are compared on a smaller data subset. Finally, details
on the internal data and memory handling of <em>xcms</em> are presented
and properties of different configurations for efficient (and parallel)
processing of large scale data are discussed.</p>
</div>
<div class="section level2">
<h2 id="data-import">Data import<a class="anchor" aria-label="anchor" href="#data-import"></a>
</h2>
<p>The data analyzed in this document was originally described in <a href="https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1004801" class="external-link">this
paper</a>. The full data is available in the MetaboLights repository
with the accession ID <a href="https://www.ebi.ac.uk/metabolights/editor/MTBLS93/descriptors" class="external-link">MTBLS93</a>.
Detailed description on the study cohort, LC-MS setup and the data
acquisition are provided in the original article’s <a href="https://doi.org/10.1371/journal.pgen.1004801.s013" class="external-link">supplement</a>.
In brief, samples were analyzed in Waters MSe mode, i.e., following an
MS1 scan, an all-ion fragmentation was performed and recorded as a MS2
scan. MS1 and MS2 data are for each samples are stored in two separate
MS data files in CDF format. MS1 data in files ending wiht
<em>01.CDF</em> and the respective MS2 scans in a file with same name,
but ending in <em>02.CDF</em>. For the present analysis we focus on MS1
data only and thus restrict the import to the MS1-only data files. The
<em>MsIO</em> R package and Bioconductor’s <em><a href="https://bioconductor.org/packages/3.21/MsBackendMetaboLights" class="external-link">MsBackendMetaboLights</a></em>
packages are used to retrieve and cache the MS data directly from the
MetaboLights repository.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsBackendMetaboLights" class="external-link">MsBackendMetaboLights</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsExperiment" class="external-link">MsExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsIO" class="external-link">MsIO</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sneumann/xcms" class="external-link">xcms</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/tpq/peakRAM" class="external-link">peakRAM</a></span><span class="op">)</span> <span class="co"># Track memory usage and processing time</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/" class="external-link">pander</a></span><span class="op">)</span>  <span class="co"># To render tables</span></span>
<span></span>
<span><span class="co">#' Retrieve the MS1 data from the MetaboLights data set</span></span>
<span><span class="va">mlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsIO/man/MetaboLightsParam.html" class="external-link">MetaboLightsParam</a></span><span class="op">(</span>mtblsId <span class="op">=</span> <span class="st">"MTBLS93"</span>, filePattern <span class="op">=</span> <span class="st">"01.CDF$"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsIO/man/saveMsObject.html" class="external-link">readMsObject</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">MsExperiment</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">mlp</span>, keepOntology <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      keepProtocol <span class="op">=</span> <span class="cn">FALSE</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">twins</span></span>
<span><span class="co">#&gt; Object of class MsExperiment</span></span>
<span><span class="co">#&gt;  Spectra: MS1 (12082605)</span></span>
<span><span class="co">#&gt;  Experiment data: 4063 sample(s)</span></span>
<span><span class="co">#&gt;  Sample data links:</span></span>
<span><span class="co">#&gt;   - spectra: 4063 sample(s) to 12082605 element(s).</span></span></code></pre></div>
<p>The data set includes in total 12082605 MS spectra for 4063
samples.</p>
<p>The size of the data object in memory:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2.7 Gb</span></span></code></pre></div>
<p>Note that this data object contains only the MS metadata (i.e.,
retention times, MS levels etc), but no MS peaks data (i.e.,
<em>m/z</em> and intensity values). With the default data representation
of the <em>Spectra</em> package, MS peaks data are only loaded upon
demand from the original data files.</p>
<div class="section level3">
<h3 id="overview-of-sample-and-experiment-metadata">Overview of sample and experiment metadata<a class="anchor" aria-label="anchor" href="#overview-of-sample-and-experiment-metadata"></a>
</h3>
<p>Various experimental and sample metadata are available for the data
set in the imported object’s <code><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData()</a></code>. These are
directly imported from the respective data files in
<em>MetaboLights</em>. The format of the imported variable names is
however not ideal for R-based data processing and we thus rename the
most relevant ones below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Select variable names with eventually interesting information</span></span>
<span><span class="va">scol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Factor Value[Gender]"</span>, <span class="st">"Factor Value[Age]"</span>,</span>
<span>          <span class="st">"Factor Value[Cluster effect]"</span>, <span class="st">"Factor Value[RMSD]"</span>,</span>
<span>          <span class="st">"Factor Value[Injection number]"</span>, <span class="st">"Factor Value[Spectrum type]"</span>,</span>
<span>          <span class="st">"Factor Value[Analysis date]"</span>, <span class="st">"Sample Name"</span><span class="op">)</span></span>
<span><span class="co">#' Define R-save names for these</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scol</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"cluster_effect"</span>, <span class="st">"rmsd"</span>, <span class="st">"injection_number"</span>,</span>
<span>                 <span class="st">"spectrum_type"</span>, <span class="st">"analysis_date"</span>, <span class="st">"sample_name"</span><span class="op">)</span></span>
<span><span class="co">#' Rename the variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">scol</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scol</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Female   Male</span></span>
<span><span class="co">#&gt;   1747   2316</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parallel-processing-setup">Parallel processing setup<a class="anchor" aria-label="anchor" href="#parallel-processing-setup"></a>
</h3>
<p>Many functions from <em>xcms</em>, in particular the ones requiring
heavy calculations, support parallel processing. Processing functions
will split the data among these processes and perform the calculations
in parallel. While parallel processing can reduce the processing time,
it is important to note that it also requires all data that is being
processed to be in memory. There should thus always be a balance between
the number of parallel processes and the available/required memory
needed. See also section <em>Performance evaluation</em> below for more
information. In our example we use 8 CPUs in parallel.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default parallel processing setup.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Every function from <em>xcms</em> supporting parallel processing will
now use this default parallel processing setup.</p>
</div>
<div class="section level3">
<h3 id="initial-data-evaluation">Initial data evaluation<a class="anchor" aria-label="anchor" href="#initial-data-evaluation"></a>
</h3>
<p>Before preprocessing, we inspect the available LC-MS data and create
a base peak chromatogram (BPC). To reduce the processing time, we create
this BPC on 200 randomly selected samples.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Select 200 randomly selected samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">twins_rand</span> <span class="op">&lt;-</span> <span class="va">twins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We next create the BPC. With parameter <code>chunkSize = 8L</code> we
specify to load and process the MS peaks data of 8 MS data files at a
time. The <code>peakRAM()</code> function is used to track memory usage
and processing time. While the function will process the data of 8 files
at a time in parallel, there is no large performance gain for that,
because the processing consists of simply returning the maximum
intensity per spectrum.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Create the BPC for the data subset</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">bpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">chromatogram</a></span><span class="op">(</span><span class="va">twins_rand</span>, aggregationFun <span class="op">=</span> <span class="st">"max"</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The time and maximal (peak) memory used are:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"BPC extraction from 200 random samples."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for BPC extraction
from 200 random samples.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">4848</td>
<td align="center">4.877</td>
</tr></tbody>
</table>
<p>The BPC of these 200 random samples is shown below.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bpc</span>, col <span class="op">=</span> <span class="st">"#00000060"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-bpc-1.png" alt="plot of chunk bpc"><div class="figcaption">plot of chunk bpc</div>
</div>
<p>Based on the BPC above, we filter the data set to spectra measured
between 20 and 900 seconds. Such restriction of the data set also avoids
to perform the chromatographic peak detection in the part of the LC
where no compounds are expected to elute. We strongly recommend such
filtering before starting preprocessing to reduce running time.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/filterSpectra.html" class="external-link">filterSpectra</a></span><span class="op">(</span><span class="va">twins</span>, <span class="va">filterRt</span>, rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">900</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We next inspect the signal for selected lipids that have been
annotated in the original article (described in Figure S2 of the <a href="https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1004801" class="external-link">original
paper</a>). The retention times and <em>m/z</em> values for these
compounds were taken from the original publication.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Define m/z and retention times for annotated lipids</span></span>
<span><span class="va">kc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LysoPC_18:1"</span>, <span class="st">"LysoPC_18:2"</span>, <span class="st">"MG_18:2"</span><span class="op">)</span>,</span>
<span>    mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">522.356</span>, <span class="fl">520.341</span>, <span class="fl">337.269</span><span class="op">)</span>,</span>
<span>    rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">382.20</span>, <span class="fl">347.28</span>, <span class="fl">384.00</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="va">kc</span><span class="op">$</span><span class="va">rtmin</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">rt</span> <span class="op">-</span> <span class="fl">20</span></span>
<span><span class="va">kc</span><span class="op">$</span><span class="va">rtmax</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">rt</span> <span class="op">+</span> <span class="fl">20</span></span>
<span><span class="va">kc</span><span class="op">$</span><span class="va">mzmin</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">mz</span> <span class="op">-</span> <span class="fl">0.01</span></span>
<span><span class="va">kc</span><span class="op">$</span><span class="va">mzmax</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">mz</span> <span class="op">+</span> <span class="fl">0.01</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">kc</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Selected lipids that were annotated in the original article."</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Selected lipids that were annotated in the original
article.</caption>
<colgroup>
<col width="23%">
<col width="18%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">name</th>
<th align="center">mz</th>
<th align="center">rt</th>
<th align="center">rtmin</th>
<th align="center">rtmax</th>
<th align="center">mzmin</th>
<th align="center">mzmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>LysoPC_18:1</strong></td>
<td align="center">LysoPC_18:1</td>
<td align="center">522.4</td>
<td align="center">382.2</td>
<td align="center">362.2</td>
<td align="center">402.2</td>
<td align="center">522.3</td>
<td align="center">522.4</td>
</tr>
<tr class="even">
<td align="center"><strong>LysoPC_18:2</strong></td>
<td align="center">LysoPC_18:2</td>
<td align="center">520.3</td>
<td align="center">347.3</td>
<td align="center">327.3</td>
<td align="center">367.3</td>
<td align="center">520.3</td>
<td align="center">520.4</td>
</tr>
<tr class="odd">
<td align="center"><strong>MG_18:2</strong></td>
<td align="center">MG_18:2</td>
<td align="center">337.3</td>
<td align="center">384</td>
<td align="center">364</td>
<td align="center">404</td>
<td align="center">337.3</td>
<td align="center">337.3</td>
</tr>
</tbody>
</table>
<p>We extract and plot the ion chromatograms (EIC) for these 3 compounds
from the 200 randomly selected samples.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract the ion chromatogram for the 3 compounds</span></span>
<span><span class="va">eics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">chromatogram</a></span><span class="op">(</span><span class="va">twins_rand</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">mzmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">mzmax</span><span class="op">)</span>,</span>
<span>                     rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">rtmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">rtmax</span><span class="op">)</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#' Plot the EICs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">eics</span>, col <span class="op">=</span> <span class="st">"#00000040"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-eic-random-1.png" alt="plot of chunk eic-random"><div class="figcaption">plot of chunk eic-random</div>
</div>
<p>Apparent retention time shifts are visible for all 3 compounds. We
can next evaluate chromatographic peak detection settings on these
example signals.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks-centWave.html" class="external-link">CentWaveParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                       peakwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                       snthresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                       mzCenterFun <span class="op">=</span> <span class="st">"wMean"</span>,</span>
<span>                       integrate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">met_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">eics</span>, param <span class="op">=</span> <span class="va">param</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">met_test</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;            mz   mzmin   mzmax      rt   rtmin   rtmax      into       intb</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.178 375.894 388.319 2329316.3 1691671.50</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.749 375.894 387.890 2109446.7 1535929.04</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.318 375.034 387.031 2393436.5 1751258.46</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.321 363.636 375.034  434015.4   74434.92</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.747 376.321 388.317 2208231.7 1624551.74</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.318 374.606 387.031 2392099.1 1752668.52</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.321 364.494 374.606  430126.8   76103.65</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.607 371.180 382.320 1214597.6  891277.16</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.044 374.617 386.614 2051008.3 1510790.55</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.904 364.505 374.617  352557.5   62286.20</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.181 376.754 387.894 1531550.0 1129829.15</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.607 371.180 382.748 1927843.5 1423372.16</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.175 375.892 388.317 1629758.9 1184918.57</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.612 377.185 389.440 1589031.2 1176171.86</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.173 376.746 389.429 2576501.4 1899088.63</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 366.214 362.358 371.614  425588.7   96881.15</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 378.040 371.614 383.610 2195087.6 1621585.16</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.754 375.899 388.324 2159818.3 1602575.03</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.177 376.322 388.318 2948737.8 2170209.49</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.464 374.609 386.605 3191880.9 2385121.53</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.896 362.354 374.609  554584.3  104143.98</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 375.889 369.462 380.602 2631447.2 1968139.48</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.745 376.318 387.886 1732314.5 1264163.10</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.173 376.317 388.314 2641640.3 1942733.78</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.181 376.326 388.322 2707103.2 1991534.74</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.607 376.752 388.323 1820800.0 1341464.66</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.317 375.462 387.887 3086967.1 2267324.93</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.173 376.318 388.314 1833619.3 1328743.13</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 375.893 369.038 381.463 3575538.5 2586045.65</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.316 375.032 387.885 2528997.2 1869255.11</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.460 374.604 387.029 2386099.7 1765416.93</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.891 363.635 374.604  434664.0   93316.89</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.176 370.320 382.317 1372886.0 1020096.86</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.744 375.889 387.457 3882497.9 2902222.68</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.606 376.750 389.433 2290938.3 1701392.78</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.467 375.041 387.037 2205818.0 1605043.83</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.899 364.068 375.041  400725.1   69333.14</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.322 375.466 387.463 2983000.5 2215309.75</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.325 364.069 375.466  536203.8  100866.18</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.470 374.614 387.039 1744270.9 1277046.70</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.901 363.217 374.614  310520.7   62002.05</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.887 375.461 387.457 2570326.9 1902625.93</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.319 364.063 375.461  461963.8   90928.84</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 365.787 362.359 370.329  336029.1   77130.24</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.612 370.329 382.754 1753468.1 1295049.99</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.462 375.035 386.603 1960124.3 1461845.40</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.894 364.066 375.035  351685.1   65673.61</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.030 378.032 389.429 2839861.5 2148561.46</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.177 375.893 387.890 2022734.3 1424566.11</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.464 374.609 387.034 2120881.8 1556217.28</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.327 375.472 387.468 3059265.1 2290832.82</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 376.750 369.894 381.463 1572198.4 1164669.17</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.754 375.899 388.324 2175046.0 1601646.34</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.037 377.610 389.436 2592548.2 1898588.63</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.172 376.317 388.314 3459509.6 2586778.59</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 378.032 371.177 383.173 4115139.5 3083989.90</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.890 374.607 387.032 2435019.5 1780321.29</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.894 364.065 374.607  438228.2   75817.86</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.751 375.896 387.892 2108334.0 1528709.51</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 365.785 362.357 371.184  257020.8   58746.50</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.611 371.184 382.752 1279288.1  945989.96</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.754 376.327 388.323 2860061.5 2110207.60</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.174 376.747 388.316 1623732.7 1181611.49</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.177 369.893 381.890 1450736.1 1070691.17</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 376.747 369.892 381.888 2417939.6 1790279.09</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 364.921 362.350 369.892  477242.6  108814.56</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.327 375.469 387.468 2054364.1 1489768.27</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 376.323 369.468 381.465 1896668.1 1341881.84</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.614 367.501 380.183 2512580.9 1802720.55</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.214 362.357 367.501  267706.8   31522.33</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.186 367.929 380.184 2806922.9 2037468.41</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.216 362.360 367.929  305205.5   44233.13</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.610 376.326 389.437 1680233.2 1223924.74</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.890 375.035 387.035 2839944.8 2124523.57</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.893 363.209 375.035  498447.0   92836.46</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.321 375.037 387.462 2387610.9 1770255.07</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.753 364.497 375.037  418502.6   76885.77</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.609 376.753 389.436 1707869.3 1240638.55</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.748 375.893 387.890 2715833.1 2011645.71</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.039 374.613 386.181 2383458.6 1789110.73</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.471 362.355 374.613  405286.9   68922.42</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.321 375.894 388.319 1553144.1 1137669.96</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.463 373.750 386.175 1671733.5 1207688.53</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.466 364.495 373.750  288513.7   47258.66</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.889 375.463 387.888 3441607.2 2533879.00</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.321 363.636 375.463  634226.3  126315.55</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.177 376.322 388.318 2602114.3 1905624.44</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.181 367.068 379.751 1849167.8 1327442.63</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 362.784 362.355 367.068  181227.7   24808.36</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.611 371.185 382.753 1836921.1 1339196.74</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.033 374.178 386.174 2273686.2 1685856.81</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.465 362.351 374.178  386210.5   58625.22</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.750 375.037 387.462 1941136.0 1407841.42</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.317 375.462 387.887 2908273.1 2171393.49</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.749 364.492 375.462  525866.9  107235.46</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.324 375.897 388.323 1930101.1 1433470.24</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.888 375.033 387.029 2104067.1 1579663.86</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.891 364.064 375.033  374093.3   82309.65</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.030 377.603 390.286 2816404.0 2105579.31</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.173 376.318 387.886 1860123.3 1353316.23</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.752 375.897 387.894 2060690.8 1524632.98</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.183 370.328 382.753 2398310.6 1776359.45</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.033 377.178 389.433 2016474.3 1503485.86</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 376.747 369.892 381.888 1547326.5 1146186.03</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.175 370.320 383.603 3267830.4 2455793.13</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.743 375.887 388.313 2594247.4 1873505.46</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.601 377.174 389.429 2290447.0 1698780.21</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.035 377.180 389.436 2188753.8 1616893.48</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.603 376.747 388.316 2460009.9 1810715.92</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.179 367.495 379.749 3427851.9 2473450.62</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 362.782 362.353 367.495  372087.4   56528.76</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 378.462 372.036 383.175 1732354.5 1291130.12</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 366.636 362.352 372.036  321711.8   65439.54</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.888 375.461 387.457 2398272.9 1782877.22</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.319 364.063 375.461  430338.6   87766.60</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.181 375.897 388.322 1603270.6 1175248.15</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 376.320 369.465 381.461 1869104.7 1372367.90</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.328 375.044 387.469 3082433.4 2268962.12</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.604 367.920 394.144 4831351.8 3201555.22</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.207 362.350 367.920  518646.0   67333.93</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.034 374.179 386.176 3515374.7 2613813.20</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.466 363.210 374.179  618747.6  112703.34</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.747 375.892 387.888 3926847.7 2911104.77</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.319 375.892 387.461 2903971.2 2149496.31</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.462 374.178 386.603 2455397.1 1777168.53</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.036 374.180 386.177 3655263.1 2735203.41</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.467 362.783 374.180  600349.1   89983.64</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.031 374.176 386.173 2734818.9 2068683.65</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.463 363.207 374.176  464874.5   87599.05</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.474 375.476 387.472 2500566.2 1870099.34</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.906 364.506 375.476  454479.8   95211.65</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.178 375.894 387.891  975931.6  709929.88</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.608 377.182 390.722 2575421.6 1917031.01</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.612 376.757 389.440 2023281.7 1480673.18</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.608 371.610 382.321 1768729.0 1311186.28</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.185 377.187 389.441 2221410.8 1660751.00</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.615 370.331 382.328 1596238.2 1164622.07</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.755 375.900 387.897 2174740.6 1571647.17</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.601 376.318 388.314 3141739.6 2290738.90</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 366.215 362.359 370.758  342072.9   75665.96</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.613 370.758 383.183 1801191.5 1338311.43</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.173 375.890 387.886 1952504.9 1414881.83</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.891 375.464 387.032 2689176.8 2019966.43</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.894 363.638 375.464  491346.9  107065.33</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.605 367.492 379.746 2820994.7 2039365.32</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.207 362.350 367.492  325471.8   49337.28</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.183 370.327 381.896 2491687.0 1827564.73</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.747 375.892 387.891 2030175.9 1488602.17</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.893 375.035 387.034 3042707.7 2186548.50</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.754 376.327 387.895 2317259.0 1712817.01</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 366.216 362.360 371.615  407195.8   88697.78</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 378.042 371.615 383.183 2115309.4 1574874.53</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.041 376.757 389.440 1698767.8 1225010.04</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.755 375.900 388.325 2381527.4 1774809.40</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.756 375.900 387.897 2646746.7 1949922.67</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.893 375.037 387.034 1716654.1 1267824.37</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.896 363.638 375.037  302022.7   56762.70</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.322 375.467 387.892 3003463.9 2171491.76</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 373.748 367.492 379.318 4314066.9 3216038.15</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 362.779 362.350 367.492  462992.4   88084.72</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.891 374.608 386.604 2589521.9 1884998.67</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 375.034 367.921 380.175 3795309.3 2731289.55</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.606 370.750 382.747 1593461.9 1182094.34</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.035 373.751 387.462 2679117.9 1929073.93</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.467 362.354 373.751  460677.3   69319.93</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.750 375.895 388.320 2211528.4 1614088.25</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.179 376.753 389.436 2728839.6 2033429.50</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.747 376.749 388.317 4462456.3 3359281.38</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 375.891 369.036 380.175 2765294.8 2051628.31</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.893 378.466 389.864 1850762.9 1357849.61</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 376.746 370.319 381.887 1838111.4 1384937.19</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 364.920 362.349 370.319  348657.3   79093.96</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.187 370.331 382.328 1919850.2 1414417.19</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.319 375.463 387.460 2512170.8 1825938.48</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.176 375.893 388.318 3464110.3 2548938.97</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.325 375.041 387.895 1711929.3 1236520.51</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.750 375.466 387.463 1874994.7 1356212.89</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.031 378.032 389.430 2335830.3 1750741.50</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.326 375.043 387.468 1856984.8 1353801.10</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.750 375.466 387.891 2374613.8 1731508.24</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.755 376.329 387.897 1224086.2  912666.04</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.759 365.785 376.329  234859.9   48467.91</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 375.471 367.930 380.613 2815492.0 2039228.18</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.177 375.894 387.890 3520511.7 2543703.97</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.040 377.185 389.868 2177350.0 1587466.74</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 366.207 362.351 371.606  433835.4  108867.86</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.604 371.606 382.746 2115917.6 1586722.51</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.319 375.035 387.032 1836587.3 1332930.29</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.751 364.495 375.035  345512.1   60528.73</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.608 367.923 379.749 3913180.9 2967303.64</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.210 362.353 367.923  441399.8  101855.91</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.181 370.326 381.894 1647764.0 1230961.34</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.172 375.460 387.885 3167492.8 2323885.71</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.175 376.748 387.888 2019163.5 1477971.10</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.607 367.923 387.032 2550426.6 1808383.23</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.210 362.353 367.923  307543.1   71084.43</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.605 370.321 382.318 1556959.9 1109312.71</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.605 376.749 389.432 2800439.6 2068253.05</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.182 375.899 388.327 2135799.0 1549305.38</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.321 375.466 387.891 2858350.2 2122520.26</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.325 364.068 375.466  533950.6  119288.08</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.320 375.893 387.890 2309688.4 1722115.28</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.752 364.924 375.893  434450.1   88519.09</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.040 374.184 386.181 3162709.2 2365360.58</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.900 363.644 374.184  538486.3   94416.87</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.891 374.608 386.604 1919625.7 1413361.24</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.895 363.210 374.608  338807.8   64929.27</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.031 376.747 389.430 3574349.2 2619786.77</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.035 374.180 386.605 2846110.7 2107483.17</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.467 364.068 374.180  503873.6   94600.22</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.747 375.892 388.317 1914724.6 1369926.79</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.175 376.320 388.316 3006959.5 2220269.66</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 378.889 371.606 384.031 1921871.0 1407428.48</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 366.635 362.350 371.606  349116.9   72229.71</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.174 376.747 389.433 3403531.9 2527401.86</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.171 376.744 389.427 2312758.2 1705158.93</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.172 376.317 388.314 1932861.1 1371756.67</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.749 376.322 388.319 2648367.9 1961782.47</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 375.466 369.039 381.036 3384097.4 2491074.90</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 365.351 362.352 370.322  244400.6   56296.32</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.177 370.322 382.747 1243229.5  919984.16</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 375.044 367.931 379.757 3401917.5 2532918.45</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.218 362.361 367.931  440918.5   93091.05</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 384.459 378.032 390.287 2550648.3 1908433.56</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 376.318 369.891 381.888 3853586.8 2846487.26</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.032 374.177 385.745 2821263.8 2085828.83</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.464 363.208 374.177  482147.5   70749.46</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.178 376.751 389.434 2897790.2 2154484.07</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.462 374.606 386.603 1647892.9 1226547.13</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.893 365.351 374.606  278696.2   46999.41</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.036 373.752 386.177 2020923.5 1462086.20</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.468 362.355 373.752  340468.3   47034.35</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.179 376.324 388.320 1577779.1 1139311.95</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.178 376.751 388.319 3359094.6 2486753.17</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.175 376.748 388.316 1841937.5 1354622.15</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.745 376.746 388.314 1166437.2  837247.79</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.890 375.034 387.459 2743686.0 2046556.01</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.322 364.065 375.034  481238.6   92630.72</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.602 376.747 389.429 3428582.1 2588084.81</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 371.604 365.776 376.747  646964.6  147756.72</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.323 375.468 387.465 1145822.5  838750.87</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.755 364.927 375.468  214481.2   39355.57</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.036 373.752 385.751 1445241.5 1048126.32</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.467 362.354 373.752  244374.5   32865.30</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.751 375.896 387.896 1589300.4 1130817.52</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 364.923 362.352 370.322  624172.7  175046.58</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 376.749 370.322 382.747 2966208.1 2234019.11</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.183 367.927 379.753 3288162.9 2508525.88</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.214 362.357 367.927  363254.6   85045.73</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.474 374.619 386.616 2327763.7 1693686.86</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.906 362.793 374.619  412984.1   72401.54</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.604 367.920 381.459 2613982.1 1896292.25</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.207 362.350 367.920  297866.1   54577.98</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.321 375.466 387.891 3033563.0 2222154.91</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 380.606 373.323 385.748 2129342.8 1578041.91</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.467 362.354 373.323  375599.6   60424.71</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.746 375.462 387.887 1978066.9 1434326.17</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.609 367.924 381.039 3001146.6 2197610.82</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.211 362.354 367.924  349321.1   65234.48</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.901 374.617 386.617 1959836.4 1441143.39</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 369.904 364.076 374.617  361967.8   73823.90</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.749 375.466 387.891 1931735.0 1421249.78</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 375.033 367.920 381.032 1568617.2 1113491.16</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 363.207 362.350 367.920  195614.8   34299.58</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 381.893 375.037 387.462 2206663.4 1618709.06</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.324 362.783 375.037  400282.3   73240.71</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.754 376.756 387.896 2397374.5 1777954.32</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 374.176 367.492 379.746 2819379.4 2046839.32</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 362.779 362.350 367.492  304216.8   48229.23</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.176 376.318 388.317 2574295.2 1863297.21</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 365.784 362.357 369.898  250445.9   55641.36</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.610 369.898 382.323 1262619.8  918800.48</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 377.611 370.756 382.753 1538661.9 1141035.50</span></span>
<span><span class="co">#&gt;            maxo sn row column</span></span>
<span><span class="co">#&gt; mzmin 505062.25  5   1      1</span></span>
<span><span class="co">#&gt; mzmin 469037.25  5   1      2</span></span>
<span><span class="co">#&gt; mzmin 527234.00  5   1      3</span></span>
<span><span class="co">#&gt; mzmin  99709.62  0   1      3</span></span>
<span><span class="co">#&gt; mzmin 476111.50  5   1      4</span></span>
<span><span class="co">#&gt; mzmin 544067.50  5   1      5</span></span>
<span><span class="co">#&gt; mzmin  99405.19  0   1      5</span></span>
<span><span class="co">#&gt; mzmin 274477.00  5   1      6</span></span>
<span><span class="co">#&gt; mzmin 460259.50  5   1      7</span></span>
<span><span class="co">#&gt; mzmin  86726.44  0   1      7</span></span>
<span><span class="co">#&gt; mzmin 341555.25  5   1      8</span></span>
<span><span class="co">#&gt; mzmin 422490.25  5   1      9</span></span>
<span><span class="co">#&gt; mzmin 358786.75  5   1     10</span></span>
<span><span class="co">#&gt; mzmin 337271.50  5   1     11</span></span>
<span><span class="co">#&gt; mzmin 530651.00  5   1     12</span></span>
<span><span class="co">#&gt; mzmin  97933.19  0   1     13</span></span>
<span><span class="co">#&gt; mzmin 495421.50  5   1     13</span></span>
<span><span class="co">#&gt; mzmin 482105.50  5   1     14</span></span>
<span><span class="co">#&gt; mzmin 654380.00  5   1     15</span></span>
<span><span class="co">#&gt; mzmin 696622.00  5   1     16</span></span>
<span><span class="co">#&gt; mzmin 133485.38  0   1     16</span></span>
<span><span class="co">#&gt; mzmin 580158.50  5   1     17</span></span>
<span><span class="co">#&gt; mzmin 386764.50  5   1     18</span></span>
<span><span class="co">#&gt; mzmin 567964.00  5   1     19</span></span>
<span><span class="co">#&gt; mzmin 599651.50  5   1     20</span></span>
<span><span class="co">#&gt; mzmin 396753.25  5   1     21</span></span>
<span><span class="co">#&gt; mzmin 670585.00  5   1     22</span></span>
<span><span class="co">#&gt; mzmin 412412.75  5   1     23</span></span>
<span><span class="co">#&gt; mzmin 783054.50  5   1     24</span></span>
<span><span class="co">#&gt; mzmin 560243.00  5   1     25</span></span>
<span><span class="co">#&gt; mzmin 535759.50  5   1     26</span></span>
<span><span class="co">#&gt; mzmin 105577.31  0   1     26</span></span>
<span><span class="co">#&gt; mzmin 310655.00  5   1     27</span></span>
<span><span class="co">#&gt; mzmin 871173.50  5   1     28</span></span>
<span><span class="co">#&gt; mzmin 485717.75  5   1     29</span></span>
<span><span class="co">#&gt; mzmin 484035.50  5   1     30</span></span>
<span><span class="co">#&gt; mzmin  94391.25  0   1     30</span></span>
<span><span class="co">#&gt; mzmin 659508.50  5   1     31</span></span>
<span><span class="co">#&gt; mzmin 127623.81  0   1     31</span></span>
<span><span class="co">#&gt; mzmin 378348.25  5   1     32</span></span>
<span><span class="co">#&gt; mzmin  76249.00  0   1     32</span></span>
<span><span class="co">#&gt; mzmin 588307.50  5   1     33</span></span>
<span><span class="co">#&gt; mzmin 111054.12  0   1     33</span></span>
<span><span class="co">#&gt; mzmin  80581.44  0   1     34</span></span>
<span><span class="co">#&gt; mzmin 398369.00  5   1     34</span></span>
<span><span class="co">#&gt; mzmin 429353.25  5   1     35</span></span>
<span><span class="co">#&gt; mzmin  85248.75  0   1     35</span></span>
<span><span class="co">#&gt; mzmin 613045.00  5   1     36</span></span>
<span><span class="co">#&gt; mzmin 433912.25  5   1     37</span></span>
<span><span class="co">#&gt; mzmin 443480.00  5   1     38</span></span>
<span><span class="co">#&gt; mzmin 688977.50  5   1     39</span></span>
<span><span class="co">#&gt; mzmin 347689.25  5   1     40</span></span>
<span><span class="co">#&gt; mzmin 469665.50  5   1     41</span></span>
<span><span class="co">#&gt; mzmin 560474.00  5   1     42</span></span>
<span><span class="co">#&gt; mzmin 769049.00  5   1     43</span></span>
<span><span class="co">#&gt; mzmin 909657.00  5   1     44</span></span>
<span><span class="co">#&gt; mzmin 522593.00  5   1     45</span></span>
<span><span class="co">#&gt; mzmin 100564.25  0   1     45</span></span>
<span><span class="co">#&gt; mzmin 450016.75  5   1     46</span></span>
<span><span class="co">#&gt; mzmin  58704.38  0   1     47</span></span>
<span><span class="co">#&gt; mzmin 282637.75  5   1     47</span></span>
<span><span class="co">#&gt; mzmin 648903.00  5   1     48</span></span>
<span><span class="co">#&gt; mzmin 349884.75  5   1     49</span></span>
<span><span class="co">#&gt; mzmin 324932.25  5   1     50</span></span>
<span><span class="co">#&gt; mzmin 550390.50  5   1     51</span></span>
<span><span class="co">#&gt; mzmin 110184.38  0   1     51</span></span>
<span><span class="co">#&gt; mzmin 453999.75  5   1     52</span></span>
<span><span class="co">#&gt; mzmin 394729.00  5   1     53</span></span>
<span><span class="co">#&gt; mzmin 467216.75  4   1     54</span></span>
<span><span class="co">#&gt; mzmin  80938.94  0   1     54</span></span>
<span><span class="co">#&gt; mzmin 505360.50  4   1     55</span></span>
<span><span class="co">#&gt; mzmin  97738.19  0   1     55</span></span>
<span><span class="co">#&gt; mzmin 354359.25  5   1     56</span></span>
<span><span class="co">#&gt; mzmin 618766.50  5   1     57</span></span>
<span><span class="co">#&gt; mzmin 115579.00  0   1     57</span></span>
<span><span class="co">#&gt; mzmin 535672.00  5   1     58</span></span>
<span><span class="co">#&gt; mzmin  97729.69  0   1     58</span></span>
<span><span class="co">#&gt; mzmin 345654.75  5   1     59</span></span>
<span><span class="co">#&gt; mzmin 617972.00  5   1     60</span></span>
<span><span class="co">#&gt; mzmin 528756.50  5   1     61</span></span>
<span><span class="co">#&gt; mzmin  99231.75  0   1     61</span></span>
<span><span class="co">#&gt; mzmin 346038.25  5   1     62</span></span>
<span><span class="co">#&gt; mzmin 377532.75  5   1     63</span></span>
<span><span class="co">#&gt; mzmin  71880.00  0   1     63</span></span>
<span><span class="co">#&gt; mzmin 749257.50  5   1     64</span></span>
<span><span class="co">#&gt; mzmin 148101.75  0   1     64</span></span>
<span><span class="co">#&gt; mzmin 563324.50  5   1     65</span></span>
<span><span class="co">#&gt; mzmin 338636.25  4   1     66</span></span>
<span><span class="co">#&gt; mzmin  64183.00  0   1     66</span></span>
<span><span class="co">#&gt; mzmin 415433.75  5   1     67</span></span>
<span><span class="co">#&gt; mzmin 493507.75  5   1     68</span></span>
<span><span class="co">#&gt; mzmin  91182.31  0   1     68</span></span>
<span><span class="co">#&gt; mzmin 432411.75  5   1     69</span></span>
<span><span class="co">#&gt; mzmin 652434.00  5   1     70</span></span>
<span><span class="co">#&gt; mzmin 120804.25  0   1     70</span></span>
<span><span class="co">#&gt; mzmin 416632.00  5   1     71</span></span>
<span><span class="co">#&gt; mzmin 468365.75  5   1     72</span></span>
<span><span class="co">#&gt; mzmin  90546.19  0   1     72</span></span>
<span><span class="co">#&gt; mzmin 596241.50  4   1     73</span></span>
<span><span class="co">#&gt; mzmin 410788.25  5   1     74</span></span>
<span><span class="co">#&gt; mzmin 459830.75  5   1     75</span></span>
<span><span class="co">#&gt; mzmin 540872.50  5   1     76</span></span>
<span><span class="co">#&gt; mzmin 429923.75  5   1     77</span></span>
<span><span class="co">#&gt; mzmin 337735.75  5   1     78</span></span>
<span><span class="co">#&gt; mzmin 725348.50  5   1     79</span></span>
<span><span class="co">#&gt; mzmin 542000.00  5   1     80</span></span>
<span><span class="co">#&gt; mzmin 468235.75  5   1     81</span></span>
<span><span class="co">#&gt; mzmin 468371.00  5   1     82</span></span>
<span><span class="co">#&gt; mzmin 552889.50  5   1     83</span></span>
<span><span class="co">#&gt; mzmin 636915.50  4   1     84</span></span>
<span><span class="co">#&gt; mzmin 123911.31  0   1     84</span></span>
<span><span class="co">#&gt; mzmin 390472.50  5   1     85</span></span>
<span><span class="co">#&gt; mzmin  75670.31  0   1     85</span></span>
<span><span class="co">#&gt; mzmin 534114.50  5   1     86</span></span>
<span><span class="co">#&gt; mzmin 102293.38  0   1     86</span></span>
<span><span class="co">#&gt; mzmin 349704.50  5   1     87</span></span>
<span><span class="co">#&gt; mzmin 411993.75  5   1     88</span></span>
<span><span class="co">#&gt; mzmin 684744.50  5   1     89</span></span>
<span><span class="co">#&gt; mzmin 784298.00  4   1     90</span></span>
<span><span class="co">#&gt; mzmin 146382.75  0   1     90</span></span>
<span><span class="co">#&gt; mzmin 801146.50  5   1     91</span></span>
<span><span class="co">#&gt; mzmin 155463.50  0   1     91</span></span>
<span><span class="co">#&gt; mzmin 880783.50  5   1     92</span></span>
<span><span class="co">#&gt; mzmin 631979.00  5   1     93</span></span>
<span><span class="co">#&gt; mzmin 526810.00  5   1     94</span></span>
<span><span class="co">#&gt; mzmin 797662.00  5   1     95</span></span>
<span><span class="co">#&gt; mzmin 150555.62  0   1     95</span></span>
<span><span class="co">#&gt; mzmin 627422.50  5   1     96</span></span>
<span><span class="co">#&gt; mzmin 118060.19  0   1     96</span></span>
<span><span class="co">#&gt; mzmin 535503.00  5   1     97</span></span>
<span><span class="co">#&gt; mzmin 108710.06  0   1     97</span></span>
<span><span class="co">#&gt; mzmin 214049.50  5   1     98</span></span>
<span><span class="co">#&gt; mzmin 546659.00  5   1     99</span></span>
<span><span class="co">#&gt; mzmin 418177.25  4   1    100</span></span>
<span><span class="co">#&gt; mzmin 395658.00  5   1    101</span></span>
<span><span class="co">#&gt; mzmin 476857.25  5   1    102</span></span>
<span><span class="co">#&gt; mzmin 349556.75  5   1    103</span></span>
<span><span class="co">#&gt; mzmin 463396.75  5   1    104</span></span>
<span><span class="co">#&gt; mzmin 689120.50  5   1    105</span></span>
<span><span class="co">#&gt; mzmin  79409.56  0   1    106</span></span>
<span><span class="co">#&gt; mzmin 409021.00  5   1    106</span></span>
<span><span class="co">#&gt; mzmin 431215.25  5   1    107</span></span>
<span><span class="co">#&gt; mzmin 595986.00  5   1    108</span></span>
<span><span class="co">#&gt; mzmin 115880.94  0   1    108</span></span>
<span><span class="co">#&gt; mzmin 525786.00  4   1    109</span></span>
<span><span class="co">#&gt; mzmin 100198.44  0   1    109</span></span>
<span><span class="co">#&gt; mzmin 542828.00  5   1    110</span></span>
<span><span class="co">#&gt; mzmin 435780.00  5   1    111</span></span>
<span><span class="co">#&gt; mzmin 654031.50  5   1    112</span></span>
<span><span class="co">#&gt; mzmin 507430.50  5   1    113</span></span>
<span><span class="co">#&gt; mzmin  93856.75  0   1    114</span></span>
<span><span class="co">#&gt; mzmin 472216.50  5   1    114</span></span>
<span><span class="co">#&gt; mzmin 357488.25  5   1    115</span></span>
<span><span class="co">#&gt; mzmin 522813.25  5   1    116</span></span>
<span><span class="co">#&gt; mzmin 584634.00  5   1    117</span></span>
<span><span class="co">#&gt; mzmin 380565.00  5   1    118</span></span>
<span><span class="co">#&gt; mzmin  72141.19  0   1    118</span></span>
<span><span class="co">#&gt; mzmin 646349.00  5   1    119</span></span>
<span><span class="co">#&gt; mzmin 876852.00  5   1    120</span></span>
<span><span class="co">#&gt; mzmin 158602.38  0   1    120</span></span>
<span><span class="co">#&gt; mzmin 570932.50  5   1    121</span></span>
<span><span class="co">#&gt; mzmin 770536.00  5   1    122</span></span>
<span><span class="co">#&gt; mzmin 351706.25  5   1    123</span></span>
<span><span class="co">#&gt; mzmin 545440.50  5   1    124</span></span>
<span><span class="co">#&gt; mzmin 111217.25  0   1    124</span></span>
<span><span class="co">#&gt; mzmin 470147.75  5   1    125</span></span>
<span><span class="co">#&gt; mzmin 577577.50  5   1    126</span></span>
<span><span class="co">#&gt; mzmin 982702.50  5   1    127</span></span>
<span><span class="co">#&gt; mzmin 618394.50  5   1    128</span></span>
<span><span class="co">#&gt; mzmin 393125.00  5   1    129</span></span>
<span><span class="co">#&gt; mzmin 418638.25  5   1    130</span></span>
<span><span class="co">#&gt; mzmin  84117.31  0   1    130</span></span>
<span><span class="co">#&gt; mzmin 436238.00  5   1    131</span></span>
<span><span class="co">#&gt; mzmin 539739.00  5   1    132</span></span>
<span><span class="co">#&gt; mzmin 751589.50  5   1    133</span></span>
<span><span class="co">#&gt; mzmin 369992.25  5   1    134</span></span>
<span><span class="co">#&gt; mzmin 408669.75  5   1    135</span></span>
<span><span class="co">#&gt; mzmin 489026.75  5   1    136</span></span>
<span><span class="co">#&gt; mzmin 413686.00  5   1    137</span></span>
<span><span class="co">#&gt; mzmin 525865.00  5   1    138</span></span>
<span><span class="co">#&gt; mzmin 278108.50  5   1    139</span></span>
<span><span class="co">#&gt; mzmin  53870.31  0   1    139</span></span>
<span><span class="co">#&gt; mzmin 574771.00  5   1    140</span></span>
<span><span class="co">#&gt; mzmin 784325.50  5   1    141</span></span>
<span><span class="co">#&gt; mzmin 462810.50  5   1    142</span></span>
<span><span class="co">#&gt; mzmin 101750.38  1   1    143</span></span>
<span><span class="co">#&gt; mzmin 480395.25  5   1    143</span></span>
<span><span class="co">#&gt; mzmin 408442.75  5   1    144</span></span>
<span><span class="co">#&gt; mzmin  82881.75  0   1    144</span></span>
<span><span class="co">#&gt; mzmin 800261.50  5   1    145</span></span>
<span><span class="co">#&gt; mzmin 148591.75  0   1    145</span></span>
<span><span class="co">#&gt; mzmin 387537.25  5   1    146</span></span>
<span><span class="co">#&gt; mzmin 696948.00  5   1    147</span></span>
<span><span class="co">#&gt; mzmin 453467.25  5   1    148</span></span>
<span><span class="co">#&gt; mzmin 500884.00  5   1    149</span></span>
<span><span class="co">#&gt; mzmin  91079.81  0   1    149</span></span>
<span><span class="co">#&gt; mzmin 334148.25  5   1    150</span></span>
<span><span class="co">#&gt; mzmin 583614.00  5   1    151</span></span>
<span><span class="co">#&gt; mzmin 475058.50  5   1    152</span></span>
<span><span class="co">#&gt; mzmin 626606.00  5   1    153</span></span>
<span><span class="co">#&gt; mzmin 129955.50  0   1    153</span></span>
<span><span class="co">#&gt; mzmin 516856.50  5   1    154</span></span>
<span><span class="co">#&gt; mzmin 101405.25  0   1    154</span></span>
<span><span class="co">#&gt; mzmin 710441.50  5   1    155</span></span>
<span><span class="co">#&gt; mzmin 134606.62  0   1    155</span></span>
<span><span class="co">#&gt; mzmin 434388.50  5   1    156</span></span>
<span><span class="co">#&gt; mzmin  84035.31  0   1    156</span></span>
<span><span class="co">#&gt; mzmin 745037.00  5   1    157</span></span>
<span><span class="co">#&gt; mzmin 623132.00  5   1    158</span></span>
<span><span class="co">#&gt; mzmin 129783.62  0   1    158</span></span>
<span><span class="co">#&gt; mzmin 408664.25  5   1    159</span></span>
<span><span class="co">#&gt; mzmin 667948.50  5   1    160</span></span>
<span><span class="co">#&gt; mzmin 421596.00  5   1    161</span></span>
<span><span class="co">#&gt; mzmin  82891.94  0   1    161</span></span>
<span><span class="co">#&gt; mzmin 699641.50  5   1    162</span></span>
<span><span class="co">#&gt; mzmin 478371.75  5   1    163</span></span>
<span><span class="co">#&gt; mzmin 404516.75  4   1    164</span></span>
<span><span class="co">#&gt; mzmin 592300.50  5   1    165</span></span>
<span><span class="co">#&gt; mzmin 723406.00  5   1    166</span></span>
<span><span class="co">#&gt; mzmin  58321.78  1   1    167</span></span>
<span><span class="co">#&gt; mzmin 281265.50  5   1    167</span></span>
<span><span class="co">#&gt; mzmin 705038.00  5   1    168</span></span>
<span><span class="co">#&gt; mzmin 132605.12  0   1    168</span></span>
<span><span class="co">#&gt; mzmin 542212.00  5   1    169</span></span>
<span><span class="co">#&gt; mzmin 831527.50  5   1    170</span></span>
<span><span class="co">#&gt; mzmin 637830.50  5   1    171</span></span>
<span><span class="co">#&gt; mzmin 118921.50  0   1    171</span></span>
<span><span class="co">#&gt; mzmin 589878.50  5   1    172</span></span>
<span><span class="co">#&gt; mzmin 359412.25  5   1    173</span></span>
<span><span class="co">#&gt; mzmin  66032.00  0   1    173</span></span>
<span><span class="co">#&gt; mzmin 438044.25  5   1    174</span></span>
<span><span class="co">#&gt; mzmin  81963.75  0   1    174</span></span>
<span><span class="co">#&gt; mzmin 340489.75  4   1    175</span></span>
<span><span class="co">#&gt; mzmin 764716.00  5   1    176</span></span>
<span><span class="co">#&gt; mzmin 413497.00  5   1    177</span></span>
<span><span class="co">#&gt; mzmin 252840.25  5   1    178</span></span>
<span><span class="co">#&gt; mzmin 608550.00  5   1    179</span></span>
<span><span class="co">#&gt; mzmin 113447.69  0   1    179</span></span>
<span><span class="co">#&gt; mzmin 742607.00  5   1    180</span></span>
<span><span class="co">#&gt; mzmin 146555.12  0   1    180</span></span>
<span><span class="co">#&gt; mzmin 256186.12  5   1    181</span></span>
<span><span class="co">#&gt; mzmin  51481.81  0   1    181</span></span>
<span><span class="co">#&gt; mzmin 315986.25  5   1    182</span></span>
<span><span class="co">#&gt; mzmin  62163.91  0   1    182</span></span>
<span><span class="co">#&gt; mzmin 347370.50  5   1    183</span></span>
<span><span class="co">#&gt; mzmin 142201.88  1   1    184</span></span>
<span><span class="co">#&gt; mzmin 641799.00  5   1    184</span></span>
<span><span class="co">#&gt; mzmin 705950.50  5   1    185</span></span>
<span><span class="co">#&gt; mzmin 126246.38  0   1    185</span></span>
<span><span class="co">#&gt; mzmin 503605.75  5   1    186</span></span>
<span><span class="co">#&gt; mzmin 102277.75  0   1    186</span></span>
<span><span class="co">#&gt; mzmin 483006.25  4   1    187</span></span>
<span><span class="co">#&gt; mzmin  92715.88  0   1    187</span></span>
<span><span class="co">#&gt; mzmin 657469.50  5   1    188</span></span>
<span><span class="co">#&gt; mzmin 458763.25  5   1    189</span></span>
<span><span class="co">#&gt; mzmin  91418.88  0   1    189</span></span>
<span><span class="co">#&gt; mzmin 433193.75  5   1    190</span></span>
<span><span class="co">#&gt; mzmin 560260.00  4   1    191</span></span>
<span><span class="co">#&gt; mzmin 106375.75  0   1    191</span></span>
<span><span class="co">#&gt; mzmin 436491.50  5   1    192</span></span>
<span><span class="co">#&gt; mzmin  87910.88  0   1    192</span></span>
<span><span class="co">#&gt; mzmin 439303.50  5   1    193</span></span>
<span><span class="co">#&gt; mzmin 284208.00  4   1    194</span></span>
<span><span class="co">#&gt; mzmin  56540.03  0   1    194</span></span>
<span><span class="co">#&gt; mzmin 468735.50  5   1    195</span></span>
<span><span class="co">#&gt; mzmin  91264.31  0   1    195</span></span>
<span><span class="co">#&gt; mzmin 528609.00  5   1    196</span></span>
<span><span class="co">#&gt; mzmin 525601.00  4   1    197</span></span>
<span><span class="co">#&gt; mzmin 100532.81  0   1    197</span></span>
<span><span class="co">#&gt; mzmin 574200.50  5   1    198</span></span>
<span><span class="co">#&gt; mzmin  58813.25  0   1    199</span></span>
<span><span class="co">#&gt; mzmin 284014.00  5   1    199</span></span>
<span><span class="co">#&gt; mzmin 351122.25  5   1    200</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">met_test</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-eic-random-cp-1.png" alt="plot of chunk eic-random-cp"><div class="figcaption">plot of chunk eic-random-cp</div>
</div>
<p>Chromatographic peaks were detected in all cases, but due to the
large number of samples investigated it is not easy to evaluate the
results properly. We thus create the same plot for only the first 5
samples.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">met_test</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-eic-random-cp-5-1.png" alt="plot of chunk eic-random-cp-5"><div class="figcaption">plot of chunk eic-random-cp-5</div>
</div>
<p>The large peak was thus correctly identified. Also the lower
abundance peak would be detected if the <code>snthresh</code> would be
reduced for the peak detection in the EIC signal. Noise estimation is
difficult for peak detection in extracted ion signals, as most of the
chromatogram contains actual signal from the ion. This is different for
the preprocessing on the full data set performed in the next section as
much more <em>real</em> background signal is present in the full MS data
to properly estimate the noise.</p>
</div>
<div class="section level3">
<h3 id="preprocessing">Preprocessing<a class="anchor" aria-label="anchor" href="#preprocessing"></a>
</h3>
<p>We next perform the preprocessing of the LC-MS data. Settings of the
individual processing steps were taken from the original <a href="https://github.com/andgan/metabolomics_pipeline" class="external-link">data analysis R
script</a> and adapted to the new <em>xcms</em> interface.</p>
<p>At first we perform the chromatographic peak detection using the
<em>centWave</em> method. With the parameter <code>hdf5File</code> we
define the name (and eventually path) for a file to keep the
preprocessing results. Information on identified chromatographic peaks
and results from later preprocessing steps will then be stored into this
file. The HDF5 file format guarantees efficient storage, and retrieval,
of these results or subsets thereof. The memory footprint of this new
result object is thus very small which is ideal for the processing of
very large data sets, also on conventional computing infrastructure
(e.g. laptop). With <code>chunkSize = 8</code> we define to load and
process the MS data of 8 data files at a time. Peak detection is then
performed in parallel on 8 CPUs using our predefined default parallel
processing setup.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cwp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks-centWave.html" class="external-link">CentWaveParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                     peakwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                     prefilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>                     snthresh <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     mzCenterFun <span class="op">=</span> <span class="st">"wMean"</span>,</span>
<span>                     integrate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"twins.h5"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"twins.h5"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                            hdf5File <span class="op">=</span> <span class="st">"twins.h5"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Memory usage and time elapsed for this processing step where:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"the chromatographic peak detection step on the"</span>,</span>
<span>                     <span class="st">" full data."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for the
chromatographic peak detection step on the full data.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">8618</td>
<td align="center">422.1</td>
</tr></tbody>
</table>
<p>As a result, the <code><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks()</a></code> function returned an
object of type <code>XcmsExperimentHdf5</code>, which, as described
above, stored all preprocessing results on-disk in a file in HDF5
format. The size of this result object in memory is thus not much larger
than the original object representing the MS data:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.8 Gb</span></span></code></pre></div>
<p>The identified chromatographic peaks are stored as a numeric matrix.
Depending on the size of the experiment and MS data files as well as the
used peak detection settings, this matrix can also be very large and use
a big part of the main memory, which can significantly slow down
subsequent analysis steps. Below we load this data matrix into memory to
evaluate its size.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Load the chromatographic peak detection results and</span></span>
<span><span class="co">#' get its size.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>units <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3.4 Gb</span></span></code></pre></div>
<p>For the present data set and the used settings, the size of the
chromatographic peak matrix seems manageable also for regular computers.
However, having this data object all the time in memory can have
negative impact on processing efficiency and in the worst case have R
running out of memory along the further analysis.</p>
<p>Below we count the number of chromatographic peaks detected per
sample and determine also their total sum. Here we take advantage of the
possibility to load only selected columns of the chromatographic peak
matrix, which will reduce the memory need for the present calculation.
Also, we use <code>bySample = TRUE</code> which returns the result as a
<code>list</code> of chromatographic peak matrices. The length of the
list is equal to the number of samples and each element is the
chromatographic peak matrix of one sample.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Load the "into" column from the chrom peak matrix</span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, columns <span class="op">=</span> <span class="st">"into"</span>, bySample <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' The distribution of the number of peaks counts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">pc</span>, <span class="va">nrow</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     0%    25%    50%    75%   100%</span></span>
<span><span class="co">#&gt; 3344.0 4919.5 5511.0 6124.0 9167.0</span></span></code></pre></div>
<p>Between 5000 and 6000 chromatographic peaks have been detected per
sample. The total number of peaks is:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">pc</span>, <span class="va">nrow</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 22568648</span></span></code></pre></div>
<p>Next we perform the <em>peak refinement</em>. This step helps to
reduce common peak detection artifacts, such as duplicated peaks,
overlapping peaks or artificially split peaks. Again, we process the
data in chunks of 8 data files at a time to keep memory usage manageable
for the used computer system.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Perform peak refinement</span></span>
<span><span class="va">mnpp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">MergeNeighboringPeaksParam</a></span><span class="op">(</span>expandRt <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Memory usage and time elapsed for this processing step where:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [hours]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"the chromatographic peak refinement."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for the
chromatographic peak refinement.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [hours]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">5316</td>
<td align="center">2.926</td>
</tr></tbody>
</table>
<p>For retention time alignment we will use the <em>peak groups</em>
method, that adjusts retention time shifts between samples based on the
retention times of common compounds present in most samples (the so
called <em>anchor peaks</em>). We thus run next an initial
correspondence analysis (with relaxed settings for retention time
differences) in order to define these.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Define settings for an initial correspondence analysis:</span></span>
<span><span class="co">#' require anchor peaks to be present in 70% of samples, but use a</span></span>
<span><span class="co">#' larger bw to allow rt shifts</span></span>
<span><span class="va">pdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        minFraction <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>                        binSize <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                        ppm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        bw <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"a correspondence analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for a correspondence
analysis.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">5316</td>
<td align="center">1.525</td>
</tr></tbody>
</table>
<p>We can next perform the retention time alignment using the <em>peak
groups</em> method.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">PeakGroupsParam</a></span><span class="op">(</span>minFraction <span class="op">=</span> <span class="fl">0.8</span>, extraPeaks <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                       span <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#' Perform the alignment</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">adjustRtime</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">pgp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"the retention time alignment analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for the retention
time alignment analysis.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">2157</td>
<td align="center">1.66</td>
</tr></tbody>
</table>
<p>We evaluate the performance of the alignment on EICs for the 3 known
compounds in 200 random samples.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Select 200 random samples and extract ion chromatograms for the 3</span></span>
<span><span class="co">#' annotated lipids. We reuse the same random seed to choose the same</span></span>
<span><span class="co">#' random samples selected before. Note that we use `keepAdjustedRtime = TRUE`</span></span>
<span><span class="co">#' to avoid the retention times being restored to the original values.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">twins_rand</span> <span class="op">&lt;-</span> <span class="va">twins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span>, keepAdjustedRtime <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract the ion chromatogram for the 3 compounds</span></span>
<span><span class="va">eics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">chromatogram</a></span><span class="op">(</span><span class="va">twins_rand</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">mzmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">mzmax</span><span class="op">)</span>,</span>
<span>                     rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">rtmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">rtmax</span><span class="op">)</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#' Plot the EICs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">eics</span>, col <span class="op">=</span> <span class="st">"#00000020"</span>, peakBg <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-eic-random-align-1.png" alt="plot of chunk eic-random-align"><div class="figcaption">plot of chunk eic-random-align</div>
</div>
<p>The EICs are nicely aligned.</p>
<p>We perform now the final correspondence analysis to match aligned
chromatographic peaks across samples and define the <em>LC-MS
features</em>. We reduce <code>minFraction</code> parameter to also
define features if chromatographic peaks were only present in 30% of the
samples and use a more stringent <code>bw</code> parameter.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        minFraction <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                        binSize <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                        ppm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        bw <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"the final correspondence analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for the final
correspondence analysis.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">5242</td>
<td align="center">2.451</td>
</tr></tbody>
</table>
<p>We also evaluate whether the correspondence could correctly define
features for the 3 selected lipids.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">twins_rand</span> <span class="op">&lt;-</span> <span class="va">twins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>                    keepAdjustedRtime <span class="op">=</span> <span class="cn">TRUE</span>, keepFeatures <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="va">eics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">chromatogram</a></span><span class="op">(</span><span class="va">twins_rand</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">mzmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">mzmax</span><span class="op">)</span>,</span>
<span>                     rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">rtmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">rtmax</span><span class="op">)</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p>Correspondence was able to correctly assign the chromatographic peaks
left of the center peaks into a separate feature.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/plotChromPeakDensity.html" class="external-link">plotChromPeakDensity</a></span><span class="op">(</span><span class="va">eics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-feature-1-1.png" alt="plot of chunk feature-1"><div class="figcaption">plot of chunk feature-1</div>
</div>
<p>Also for the second example, the chromatographic peaks were assigned
to two separate features.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/plotChromPeakDensity.html" class="external-link">plotChromPeakDensity</a></span><span class="op">(</span><span class="va">eics</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-feature-2-1.png" alt="plot of chunk feature-2"><div class="figcaption">plot of chunk feature-2</div>
</div>
<p>Finally, also for the last example chromatographic peaks were
correctly assigned to features.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/plotChromPeakDensity.html" class="external-link">plotChromPeakDensity</a></span><span class="op">(</span><span class="va">eics</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-feature-3-1.png" alt="plot of chunk feature-3"><div class="figcaption">plot of chunk feature-3</div>
</div>
<p>Below we extract the feature abundances for all features in all
samples and count the total number of defined features. The
<code><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-peak-grouping-results.html" class="external-link">featureValues()</a></code> function collects and extracts this
information from the associated HDF5 file used to store the
correspondence results.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract the feature abundances for all features in all samples</span></span>
<span><span class="va">fvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-peak-grouping-results.html" class="external-link">featureValues</a></span><span class="op">(</span><span class="va">twins</span>, value <span class="op">=</span> <span class="st">"into"</span>, method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fvals</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4981</span></span></code></pre></div>
<p>The total number of missing values in this data matrix is:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">fvals</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6690736</span></span></code></pre></div>
<p>As a last step we therefore perform the gap-filling to
<em>rescue</em> abundances for features for which in some samples no
chromatographic peak was detected (and for which hence a missing value
is reported). Here we can again benefit from chunk-wise parallel
processing.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Perform the gap filling</span></span>
<span><span class="va">cpap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">ChromPeakAreaParam</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [hours]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"gap filling."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for gap
filling.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [hours]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">6737</td>
<td align="center">2.737</td>
</tr></tbody>
</table>
<p>The number of missing values after gap filling:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-peak-grouping-results.html" class="external-link">featureValues</a></span><span class="op">(</span><span class="va">twins</span>, value <span class="op">=</span> <span class="st">"into"</span>, method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 61443</span></span></code></pre></div>
<p>Since all preprocessing results are stored in an HDF5 file and hence
on-disk, the size of the final results object is not larger than the
size of the initial data object representing the MS data of the
experiment. Note that this size could be further reduced (and eventually
overall performance improved) by storing the MS data in a SQL database
and representing/interfacing it with a <code>Spectra</code> backend from
the <em><a href="https://bioconductor.org/packages/3.21/MsBackendSql" class="external-link">MsBackendSql</a></em>
package (see the last section in this vignette for more
information).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.9 Gb</span></span></code></pre></div>
<p>The results from the preprocessing could now be converted to a
<code>SummarizedExperiment</code> object using the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">quantify()</a></code> function to continue the analysis e.g. by
performing further data exploration, normalization or statistical data
analysis.</p>
</div>
</div>
<div class="section level2">
<h2 id="performance-evaluation">Performance evaluation<a class="anchor" aria-label="anchor" href="#performance-evaluation"></a>
</h2>
<p>In this section we evaluate performance and memory requirements of
<em>xcms</em> for data preprocessing. R’s copy-on-change strategy can be
a bottleneck, in particular for very large data sets as data objects
(and hence preprocessing results) are copied temporarily during a data
analysis. We compare memory usage for the default
<code>XcmsExperiment</code> object as well as the new
<code>XcmsExperimentHdf5</code> result object and evaluate scalability
of the preprocessing by distributing the load to separate CPUs. In
contract to the <code>XcmsExperiment</code> object, the
<code>XcmsExperimentHdf5</code> object keeps all preprocessing results
<em>on-disk</em> in an HDF5 file reducing thus the memory footprint.
Below we create a subset of the data consisting of 100 randomly selected
files.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tsub</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">twins</span>, <span class="st">"MsExperiment"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We perform chromatographic peak detection on this subset for
different configurations:</p>
<ul>
<li>Peak detection using the default <code>XcmsExperiment</code> result
object.</li>
<li>Peak detection using the <code>XcmsExperimentHdf5</code> result
object.</li>
<li>Peak detection using 1, 2, 4 and 8 CPUs for both result
objects.</li>
</ul>
<p>We use a <code>chunkSize = 8</code> for all these setups, which will
load the MS data for 8 data files into memory. The time and memory usage
to access this data is:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/tpq/peakRAM" class="external-link">peakRAM</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">peakRAM</span><span class="op">(</span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectra</a></span><span class="op">(</span><span class="va">tsub</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        Function_Call Elapsed_Time_sec Total_RAM_Used_MiB</span></span>
<span><span class="co">#&gt; 1 tmp&lt;-peaksData(spectra(tsub[1:8]))            5.833             1922.9</span></span>
<span><span class="co">#&gt;   Peak_RAM_Used_MiB</span></span>
<span><span class="co">#&gt; 1            3864.8</span></span></code></pre></div>
<p>And the memory used of the resulting MS data:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.9 Gb</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<p>We next execute the performance tests. To use the new
<code>XcmsExperimentHdf5</code>, we need to specify the path and file
name of the HDF5 file where the results should be stored to.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">cwp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks-centWave.html" class="external-link">CentWaveParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                     peakwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                     prefilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>                     snthresh <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     mzCenterFun <span class="op">=</span> <span class="st">"wMean"</span>,</span>
<span>                     integrate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Eventually remove the result HDF5 object if present</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"tres.h5"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"tres.h5"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Perform the comparison</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">tres_h5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                              BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span>, hdf5File <span class="op">=</span> <span class="st">"tres.h5"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, hdf5File <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, hdf5File <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span>, hdf5File <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><em>peakRAM</em> can not correctly monitor the memory usage for
multi-core processing, thus we evaluate memory usage only for the
<em>serial</em> processing setup.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"chromatographic peak detection using different number "</span>,</span>
<span>                     <span class="st">"of CPUs. Data was loaded and processed in chunks of "</span>,</span>
<span>                     <span class="st">"8 data files."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for chromatographic
peak detection using different number of CPUs. Data was loaded and
processed in chunks of 8 data files.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">6691</td>
<td align="center">40.97</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">2</td>
<td align="center">6627</td>
<td align="center">23.88</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">4</td>
<td align="center">6627</td>
<td align="center">14.94</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">8</td>
<td align="center">6627</td>
<td align="center">11.95</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">6627</td>
<td align="center">41.44</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">2</td>
<td align="center">6627</td>
<td align="center">24.21</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">4</td>
<td align="center">6627</td>
<td align="center">15.3</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">8</td>
<td align="center">6627</td>
<td align="center">12.37</td>
</tr>
</tbody>
</table>
<p>The memory demand is dependent on the <code>chunkSize</code>
parameter, i.e., the number of files (samples) from which the MS data is
loaded and processed at a time. The peak RAM usage for
<code>chunkSize = 8</code> is, for the present data set, about twice as
large as the size of the respective MS data in memory. The processing
time is reduced with an increase in the number of CPUs used, but this
relationship is not linear. This is most likely due to the overhead in
data splitting and distribution to the individual calculation nodes as
well as the result collection and their merging/export.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"CPUs"</span><span class="op">]</span>, <span class="va">tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"Processing time [min]"</span><span class="op">]</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"#ff000080"</span>, xlab <span class="op">=</span> <span class="st">"CPUs"</span>, ylab <span class="op">=</span> <span class="st">"Time [min]"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="st">"CPUs"</span><span class="op">]</span>, <span class="va">tmp</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="st">"Processing time [min]"</span><span class="op">]</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"#0000ff80"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ff000080"</span>, <span class="st">"#0000ff80"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Memory"</span>, <span class="st">"HDF5 file"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-performance-1.png" alt="plot of chunk performance"><div class="figcaption">plot of chunk performance</div>
</div>
<p>The largest performance gain is between serial processing and
parallel processing with two CPUs. Importantly, the performance of
keeping the results in memory (for the <code>XcmsExperiment</code>
result object) or storing them to a HDF5 file (for the
<code>XcmsExperimentHdf5</code> file) is comparable.</p>
<p>We next evaluate the performance of the peak refinement step for the
different setups re-using the parameter object from the peak refinement
on the full data. Processing an <code>XcmsExperimentHdf5</code> object
will overwrite the results in the associated HDF5 files. To perform the
peak refinement on the same initial data we thus need to create copies
of the original HDF5 file for each configuration.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">mnpp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">MergeNeighboringPeaksParam</a></span><span class="op">(</span>expandRt <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Create copies of the original peak detection results</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">tres_h5</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">tres_h5</span><span class="op">@</span><span class="va">hdf5_file</span>, <span class="va">tf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">t1</span><span class="op">@</span><span class="va">hdf5_file</span> <span class="op">&lt;-</span> <span class="va">tf</span></span>
<span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="va">tres_h5</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">tres_h5</span><span class="op">@</span><span class="va">hdf5_file</span>, <span class="va">tf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">t2</span><span class="op">@</span><span class="va">hdf5_file</span> <span class="op">&lt;-</span> <span class="va">tf</span></span>
<span></span>
<span><span class="va">t4</span> <span class="op">&lt;-</span> <span class="va">tres_h5</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">tres_h5</span><span class="op">@</span><span class="va">hdf5_file</span>, <span class="va">tf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">t4</span><span class="op">@</span><span class="va">hdf5_file</span> <span class="op">&lt;-</span> <span class="va">tf</span></span>
<span></span>
<span><span class="va">t8</span> <span class="op">&lt;-</span> <span class="va">tres_h5</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">tres_h5</span><span class="op">@</span><span class="va">hdf5_file</span>, <span class="va">tf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">t8</span><span class="op">@</span><span class="va">hdf5_file</span> <span class="op">&lt;-</span> <span class="va">tf</span></span>
<span></span>
<span><span class="co">#' Run peak refinement with different configurations</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">tres</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                               BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">tres</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">tres</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">tres</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">t1</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">t2</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">t4</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">t8</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"chromatographic peak refinement using different number "</span>,</span>
<span>                     <span class="st">"of CPUs. Data was loaded and processed in chunks of "</span>,</span>
<span>                     <span class="st">"8 data files."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for chromatographic
peak refinement using different number of CPUs. Data was loaded and
processed in chunks of 8 data files.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">6627</td>
<td align="center">6.408</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">2</td>
<td align="center">6571</td>
<td align="center">5.147</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">4</td>
<td align="center">6570</td>
<td align="center">4.267</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">8</td>
<td align="center">6570</td>
<td align="center">4.226</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">6570</td>
<td align="center">6.592</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">2</td>
<td align="center">6566</td>
<td align="center">5.22</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">4</td>
<td align="center">6566</td>
<td align="center">4.336</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">8</td>
<td align="center">6566</td>
<td align="center">4.65</td>
</tr>
</tbody>
</table>
<p>The maximum memory usage is the same for all settings and is again
depending on the number of data files from which raw data is imported.
The processing time is not reduced considerably by the number of CPUs.
This however depends also on the data set and the number of candidate
peaks for merging. Processing times are also similar between the
in-memory and on-disk results of the <code>XcmsExperiment</code> and
<code>XcmsExperimentHdf5</code> objects.</p>
<p>Next we evaluate the performance of a correspondence analysis with
the <em>peak density</em> method. This method uses only the
<code><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks()</a></code> matrix for the analysis and does thus not
support the <code>chunkSize</code> parameter nor does it support
parallel processing. We thus only compare the performance of in-memory
and on-disk results below.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">pdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tsub</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        minFraction <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                        binSize <span class="op">=</span> <span class="fl">0.01</span>, ppm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        bw <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Evaluate performance of the correspondence analysis</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span>,</span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">t1</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [sec]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"correspondence analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for correspondence
analysis.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [sec]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">2738</td>
<td align="center">27.19</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">2720</td>
<td align="center">28.36</td>
</tr>
</tbody>
</table>
<p>The performance and memory demand is similar for the two result
objects.</p>
<p>Next we evaluate the performance of the retention time alignment step
using the <em>peak groups</em> approach. This method relies on the peak
detection and correspondence results and does not support parallel
processing.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">pgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">PeakGroupsParam</a></span><span class="op">(</span>minFraction <span class="op">=</span> <span class="fl">0.9</span>, extraPeaks <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                       span <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Evaluate performance of the correspondence analysis</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">adjustRtime</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">pgp</span><span class="op">)</span>,</span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">adjustRtime</a></span><span class="op">(</span><span class="va">t1</span>, param <span class="op">=</span> <span class="va">pgp</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in .local(object, param, ...): Alignment results already present. Please either remove them with 'dropAdjustedRtime' in order to perform an alternative, new, alignment, or use 'applyAdjustedRtime' prior 'adjustRtime' to perform a second round of alignment.</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [sec]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"retention time alignment analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for retention time
alignment analysis.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [sec]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">2738</td>
<td align="center">27.19</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">2720</td>
<td align="center">28.36</td>
</tr>
</tbody>
</table>
<pre><code><span><span class="co">#&gt; Error in .local(object, param, ...): Alignment results already present. Please either remove them with 'dropAdjustedRtime' in order to perform an alternative, new, alignment, or use 'applyAdjustedRtime' prior 'adjustRtime' to perform a second round of alignment.</span></span>
<span><span class="co">#&gt; Error in .local(object, param, ...): Alignment results already present. Please either remove them with 'dropAdjustedRtime' in order to perform an alternative, new, alignment, or use 'applyAdjustedRtime' prior 'adjustRtime' to perform a second round of alignment.</span></span>
<span><span class="co">#&gt; Error in .local(object, param, ...): Alignment results already present. Please either remove them with 'dropAdjustedRtime' in order to perform an alternative, new, alignment, or use 'applyAdjustedRtime' prior 'adjustRtime' to perform a second round of alignment.</span></span></code></pre>
<p>Processing time is very similar for both result objects, but the
memory requirement is much lower for the <code>XcmsExperimentHdf5</code>
object.</p>
<p>Finally we evaluate the performance of the gap-filling step. This
method requires access to the full MS data and can thus again be
configured with the <code>chunkSize</code> parameter and different
parallel processing setups.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">cpap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">ChromPeakAreaParam</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                             BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">t1</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                         BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">t2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                         BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">t4</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                         BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">t8</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                         BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"gap filling using different number "</span>,</span>
<span>                     <span class="st">"of CPUs. Data was loaded and processed in chunks of "</span>,</span>
<span>                     <span class="st">"8 data files."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for gap filling using
different number of CPUs. Data was loaded and processed in chunks of 8
data files.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">6567</td>
<td align="center">5.578</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">2</td>
<td align="center">6541</td>
<td align="center">2.407</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">4</td>
<td align="center">6541</td>
<td align="center">2.457</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">8</td>
<td align="center">6541</td>
<td align="center">2.59</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">6541</td>
<td align="center">5.861</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">2</td>
<td align="center">6541</td>
<td align="center">4.851</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">4</td>
<td align="center">6541</td>
<td align="center">4.227</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">8</td>
<td align="center">6541</td>
<td align="center">4.99</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="details-of-the-software-structure-and-data-flow">Details of the software structure and data flow<a class="anchor" aria-label="anchor" href="#details-of-the-software-structure-and-data-flow"></a>
</h3>
<p>To reduce memory demand, most processing steps are applied to
<em>chunks</em> of the data at a time. Thus, only the MS data for the
currently processed chunks are realized in memory. By using the <em><a href="https://bioconductor.org/packages/3.21/Spectra" class="external-link">Spectra</a></em>
package to represent and provide the MS data, <em>xcms</em> now also
benefits from dedicated <code>Spectra</code> data <em>backends</em> that
e.g. retrieve the MS data on-the-fly from the original MS data files
(<code>MsBackendMzR</code>) or from an SQL database (using backends from
the <code>r Biocpkg("MsBackendSql")</code> package). These alternative
data representations are seamlessly integrated with <em>xcms</em> and
increase flexibility while reducing memory demand.</p>
<p>The <code>XcmsExperiment</code> result object keeps, similar to the
older result objects from <em>xcms</em>, all preprocessing results in
memory, the chromatographic peak detection results
(<code><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks()</a></code> matrix) in a large numeric matrix and the
correspondence results (<code><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">featureDefinitions()</a></code>) in a data
frame. Accessing these data is thus fast, but, depending on the size of
the experiment, they can also be very large eventually blocking a large
part of the system’s main memory. Further, for some additional analysis
steps, these tables might need to be further processed, e.g. split by
sample, which can result in (at least temporary) additional copies of
the data in memory (which can be further complicated by R’s
copy-on-change strategy). Memory usage can thus, unexpectedly to the
user, exceed the available system memory.</p>
<p>The new <code>XcmsExperimentHdf5</code> was designed to address this
issue by storing all preprocessing results in a HDF5 file on disk,
keeping thus a very lean memory footprint. Thus, the above described
chunk-wise processing of <em>xcms</em> will also only load preprocessing
results from the currently processed chunk into memory. Importing
preprocessing results from the HDF5 file comes with a little overhead,
but the functions have been optimized for import of subsets of data at a
time.</p>
</div>
<div class="section level3">
<h3 id="summary-and-guidance">Summary and guidance<a class="anchor" aria-label="anchor" href="#summary-and-guidance"></a>
</h3>
<ul>
<li><p>Use the parameter <code>chunkSize</code> to specify the number of
samples/files that should be processed at a time. Ensure to set this
value according to the system’s main memory. The MS data of samples from
one chunk should not exceed the still available (!) system
memory.</p></li>
<li><p>Parallel processing helps reduce processing time, but does not
scale linearly, since parallel processing involves also distribution of
data to, and collection of results from, the individual processing
nodes.</p></li>
<li><p>For the present analysis, a big part of computation time was
spent on the needed <em>on-the-fly</em> import of the MS data from the
original data files. CDF files might not be the most efficient data
storage container for such on-demand data retrieval. Storing the
original MS data in an SQL database (either SQLite or MariaDB/MySQL) can
further improve performance. See the <em><a href="https://bioconductor.org/packages/3.21/MsbackendSql" class="external-link">MsbackendSql</a></em>
for details. The code that could be used to store the full MS data of
the current experiment into a SQLite database is shown below:</p></li>
</ul>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Create a SQLite database</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"twins.sqlite"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MsBackendSql</span><span class="op">)</span></span>
<span><span class="va">twins_db</span> <span class="op">&lt;-</span> <span class="va">twins</span></span>
<span></span>
<span><span class="co">#' Save the full MS data into this database</span></span>
<span><span class="va">twins_db</span><span class="op">@</span><span class="va">spectra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">setBackend</a></span><span class="op">(</span><span class="va">twins_db</span><span class="op">@</span><span class="va">spectra</span>, <span class="fu">MsBackendSql</span><span class="op">(</span><span class="op">)</span>, dbcon <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<p>The R code was run on:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fri Apr 18 10:43:40 2025"</span></span></code></pre></div>
<p>Information on the computer system:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/csgillespie/benchmarkme" class="external-link">benchmarkme</a></span><span class="op">)</span></span>
<span><span class="fu">get_cpu</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $vendor_id</span></span>
<span><span class="co">#&gt; [1] "GenuineIntel"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $model_name</span></span>
<span><span class="co">#&gt; [1] "13th Gen Intel(R) Core(TM) i7-1370P"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $no_of_cores</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span><span class="fu">get_ram</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 67.1 GB</span></span></code></pre></div>
<p>Information on the R session:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.0 (2025-04-11)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Arch Linux</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /home/jo/R/R-4.5.0/lib64/R/lib/libRblas.so</span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/liblapack.so.3.12.0  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C</span></span>
<span><span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8</span></span>
<span><span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8</span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C</span></span>
<span><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C</span></span>
<span><span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; time zone: Europe/Rome</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods</span></span>
<span><span class="co">#&gt; [8] base</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] benchmarkme_1.0.8           pander_0.6.6</span></span>
<span><span class="co">#&gt;  [3] peakRAM_1.0.2               xcms_4.7.1</span></span>
<span><span class="co">#&gt;  [5] MsIO_0.0.9                  MsExperiment_1.10.0</span></span>
<span><span class="co">#&gt;  [7] ProtGenerics_1.40.0         MsBackendMetaboLights_1.2.0</span></span>
<span><span class="co">#&gt;  [9] Spectra_1.18.0              BiocParallel_1.42.0</span></span>
<span><span class="co">#&gt; [11] S4Vectors_0.46.0            BiocGenerics_0.54.0</span></span>
<span><span class="co">#&gt; [13] generics_0.1.3              BiocStyle_2.36.0</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] DBI_1.2.3                   rlang_1.1.6</span></span>
<span><span class="co">#&gt;   [3] magrittr_2.0.3              clue_0.3-66</span></span>
<span><span class="co">#&gt;   [5] MassSpecWavelet_1.74.0      matrixStats_1.5.0</span></span>
<span><span class="co">#&gt;   [7] compiler_4.5.0              RSQLite_2.3.9</span></span>
<span><span class="co">#&gt;   [9] vctrs_0.6.5                 reshape2_1.4.4</span></span>
<span><span class="co">#&gt;  [11] stringr_1.5.1               pkgconfig_2.0.3</span></span>
<span><span class="co">#&gt;  [13] MetaboCoreUtils_1.16.0      crayon_1.5.3</span></span>
<span><span class="co">#&gt;  [15] fastmap_1.2.0               dbplyr_2.5.0</span></span>
<span><span class="co">#&gt;  [17] XVector_0.48.0              rmarkdown_2.29</span></span>
<span><span class="co">#&gt;  [19] preprocessCore_1.70.0       UCSC.utils_1.4.0</span></span>
<span><span class="co">#&gt;  [21] purrr_1.0.4                 bit_4.6.0</span></span>
<span><span class="co">#&gt;  [23] xfun_0.52                   MultiAssayExperiment_1.34.0</span></span>
<span><span class="co">#&gt;  [25] cachem_1.1.0                GenomeInfoDb_1.44.0</span></span>
<span><span class="co">#&gt;  [27] jsonlite_2.0.0              progress_1.2.3</span></span>
<span><span class="co">#&gt;  [29] blob_1.2.4                  rhdf5filters_1.20.0</span></span>
<span><span class="co">#&gt;  [31] DelayedArray_0.34.0         Rhdf5lib_1.30.0</span></span>
<span><span class="co">#&gt;  [33] parallel_4.5.0              prettyunits_1.2.0</span></span>
<span><span class="co">#&gt;  [35] cluster_2.1.8.1             R6_2.6.1</span></span>
<span><span class="co">#&gt;  [37] stringi_1.8.7               RColorBrewer_1.1-3</span></span>
<span><span class="co">#&gt;  [39] limma_3.64.0                GenomicRanges_1.60.0</span></span>
<span><span class="co">#&gt;  [41] iterators_1.0.14            Rcpp_1.0.14</span></span>
<span><span class="co">#&gt;  [43] SummarizedExperiment_1.38.0 knitr_1.50</span></span>
<span><span class="co">#&gt;  [45] IRanges_2.42.0              BiocBaseUtils_1.10.0</span></span>
<span><span class="co">#&gt;  [47] Matrix_1.7-3                igraph_2.1.4</span></span>
<span><span class="co">#&gt;  [49] tidyselect_1.2.1            abind_1.4-8</span></span>
<span><span class="co">#&gt;  [51] yaml_2.3.10                 doParallel_1.0.17</span></span>
<span><span class="co">#&gt;  [53] affy_1.86.0                 codetools_0.2-20</span></span>
<span><span class="co">#&gt;  [55] curl_6.2.2                  lattice_0.22-7</span></span>
<span><span class="co">#&gt;  [57] tibble_3.2.1                plyr_1.8.9</span></span>
<span><span class="co">#&gt;  [59] withr_3.0.2                 Biobase_2.68.0</span></span>
<span><span class="co">#&gt;  [61] benchmarkmeData_1.0.4       evaluate_1.0.3</span></span>
<span><span class="co">#&gt;  [63] BiocFileCache_2.16.0        alabaster.schemas_1.8.0</span></span>
<span><span class="co">#&gt;  [65] affyio_1.78.0               pillar_1.10.2</span></span>
<span><span class="co">#&gt;  [67] BiocManager_1.30.25         filelock_1.0.3</span></span>
<span><span class="co">#&gt;  [69] MatrixGenerics_1.20.0       foreach_1.5.2</span></span>
<span><span class="co">#&gt;  [71] MALDIquant_1.22.3           MSnbase_2.34.0</span></span>
<span><span class="co">#&gt;  [73] ncdf4_1.24                  ggplot2_3.5.2</span></span>
<span><span class="co">#&gt;  [75] hms_1.1.3                   munsell_0.5.1</span></span>
<span><span class="co">#&gt;  [77] scales_1.3.0                alabaster.base_1.8.0</span></span>
<span><span class="co">#&gt;  [79] glue_1.8.0                  MsFeatures_1.16.0</span></span>
<span><span class="co">#&gt;  [81] lazyeval_0.2.2              tools_4.5.0</span></span>
<span><span class="co">#&gt;  [83] mzID_1.46.0                 data.table_1.17.0</span></span>
<span><span class="co">#&gt;  [85] vsn_3.76.0                  QFeatures_1.18.0</span></span>
<span><span class="co">#&gt;  [87] mzR_2.42.0                  XML_3.99-0.18</span></span>
<span><span class="co">#&gt;  [89] fs_1.6.6                    rhdf5_2.52.0</span></span>
<span><span class="co">#&gt;  [91] grid_4.5.0                  impute_1.82.0</span></span>
<span><span class="co">#&gt;  [93] tidyr_1.3.1                 MsCoreUtils_1.20.0</span></span>
<span><span class="co">#&gt;  [95] colorspace_2.1-1            GenomeInfoDbData_1.2.14</span></span>
<span><span class="co">#&gt;  [97] PSMatch_1.12.0              cli_3.6.4</span></span>
<span><span class="co">#&gt;  [99] S4Arrays_1.8.0              dplyr_1.1.4</span></span>
<span><span class="co">#&gt; [101] AnnotationFilter_1.32.0     pcaMethods_2.0.0</span></span>
<span><span class="co">#&gt; [103] gtable_0.3.6                digest_0.6.37</span></span>
<span><span class="co">#&gt; [105] SparseArray_1.8.0           memoise_2.0.1</span></span>
<span><span class="co">#&gt; [107] htmltools_0.5.8.1           lifecycle_1.0.4</span></span>
<span><span class="co">#&gt; [109] httr_1.4.7                  statmod_1.5.0</span></span>
<span><span class="co">#&gt; [111] bit64_4.6.0-1               MASS_7.3-65</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philippine Louail, Johannes Rainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
