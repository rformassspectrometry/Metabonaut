<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Large Scale Data Preprocessing with xcms • Metabonaut</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Large Scale Data Preprocessing with xcms">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Metabonaut</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/install_v0.html">Installation instructions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-workflows" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Workflows</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-workflows">
<li><a class="dropdown-item" href="../articles/a-end-to-end-untargeted-metabolomics.html">End-to-end workflow for untargeted metabolomics data analysis in R</a></li>
    <li><a class="dropdown-item" href="../articles/notame_normalization_and_feature_selection.html">Quality control and Feature selection with Notame</a></li>
    <li><a class="dropdown-item" href="../articles/dataset-investigation.html">Dataset investigation: What to do when you get your data</a></li>
    <li><a class="dropdown-item" href="../articles/alignment-to-external-dataset.html">Seamless Alignment: Merging New data with Existing Preprocessed Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/SpectriPy-tutorial-metabonaut.html">LC-MS/MS Data Annotation using R and Python</a></li>
    <li><a class="dropdown-item" href="../articles/large-scale-analysis.html">Large Scale Data Preprocessing with xcms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rformassspectrometry/Metabonaut/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Large Scale Data Preprocessing with xcms</h1>
                        <h4 data-toc-skip class="author">Johannes
Rainer</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/rformassspectrometry/Metabonaut/blob/devel/vignettes/large-scale-analysis.Rmd" class="external-link"><code>vignettes/large-scale-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>large-scale-analysis.Rmd</code></div>
    </div>

    
    
<!--
# Pre-render with (in the vignettes folder)
knitr::knit("large-scale-analysis.Rmd.orig", output = "large-scale-analysis.Rmd")
-->
<p><strong>Note</strong>: this vignette is <a href="https://ropensci.org/blog/2019/12/08/precompute-vignettes/" class="external-link"><strong>pre-computed</strong></a>.
See the session info for information on packages used and the date the
vignette was rendered. The vignette is completely reproducible and can
be run and evaluated locally. The full MS data is available in the
MetaboLights repository and is downloaded and cached as part of this
vignette. Thus, to run the code locally about 800GB of free disk space
is required.</p>
<p><strong>Note</strong>: the memory-saving functionality used in this
document requires <em>xcms</em> version &gt;= 3.7.1 which is currently
(April 2025) available in Bioconductor’s 3.22 developmental branch. It
can be installed from GitHub using
<code>remotes::install_github("sneumann/xcms")</code>.</p>
<p><strong>Information on computational setup</strong>: this vignette
was rendered on a <a href="https://frame.work/" class="external-link">Framework</a> notebook
with an 13th Gen Intel(R) Core(TM) i7-1370P CPU and 64GB of main
memory.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>By design, <em>xcms</em> supports preprocessing of large scale data
even with over 10,000 samples/data files. Handling the results of such
experiments is however non-trivial and can require a very large amount
of main memory. Recent updates to <em>xcms</em>, which include full
support of the MS data infrastructure provided by the <em>Spectra</em>
package as well as a new <em>on-disk</em> storage mode for preprocessing
results, further reduce <em>xcms</em>’ memory demand and hence enable
memory-saving large scale data processing also on regular computer
setups. In this document a large public metabolomics data set with about
4,000 data files is analyzed and <em>xcms</em>’ memory usage and
performance tracked. Performance and memory usage for different
configurations are compared on a smaller data subset. Finally, details
on the internal data and memory handling of <em>xcms</em> are presented
and properties of different configurations for efficient (and parallel)
processing of large scale data are discussed.</p>
</div>
<div class="section level2">
<h2 id="data-import">Data import<a class="anchor" aria-label="anchor" href="#data-import"></a>
</h2>
<p>The data analyzed in this document was originally described in <a href="https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1004801" class="external-link">this
paper</a>. The full data is available in the MetaboLights repository
with the accession ID <a href="https://www.ebi.ac.uk/metabolights/editor/MTBLS93/descriptors" class="external-link">MTBLS93</a>.
Detailed description on the study cohort, LC-MS setup and the data
acquisition are provided in the original article’s <a href="https://doi.org/10.1371/journal.pgen.1004801.s013" class="external-link">supplement</a>.
In brief, samples were analyzed in Waters MSe mode, i.e., following an
MS1 scan, an all-ion fragmentation was performed and recorded as a MS2
scan. MS1 and MS2 data are for each samples are stored in two separate
MS data files in CDF format. MS1 data in files ending wiht
<em>01.CDF</em> and the respective MS2 scans in a file with same name,
but ending in <em>02.CDF</em>. For the present analysis we focus on MS1
data only and thus restrict the import to the MS1-only data files. The
<em>MsIO</em> R package and Bioconductor’s <em><a href="https://bioconductor.org/packages/3.21/MsBackendMetaboLights" class="external-link">MsBackendMetaboLights</a></em>
packages are used to retrieve and cache the MS data directly from the
MetaboLights repository.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsBackendMetaboLights" class="external-link">MsBackendMetaboLights</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsExperiment" class="external-link">MsExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsIO" class="external-link">MsIO</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sneumann/xcms" class="external-link">xcms</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/tpq/peakRAM" class="external-link">peakRAM</a></span><span class="op">)</span> <span class="co"># Track memory usage and processing time</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/" class="external-link">pander</a></span><span class="op">)</span>  <span class="co"># To render tables</span></span>
<span></span>
<span><span class="co">#' Retrieve the MS1 data from the MetaboLights data set</span></span>
<span><span class="va">mlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsIO/man/MetaboLightsParam.html" class="external-link">MetaboLightsParam</a></span><span class="op">(</span>mtblsId <span class="op">=</span> <span class="st">"MTBLS93"</span>, filePattern <span class="op">=</span> <span class="st">"01.CDF$"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsIO/man/saveMsObject.html" class="external-link">readMsObject</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">MsExperiment</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">mlp</span>, keepOntology <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      keepProtocol <span class="op">=</span> <span class="cn">FALSE</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">twins</span></span>
<span><span class="co">#&gt; Object of class MsExperiment</span></span>
<span><span class="co">#&gt;  Spectra: MS1 (12082605)</span></span>
<span><span class="co">#&gt;  Experiment data: 4063 sample(s)</span></span>
<span><span class="co">#&gt;  Sample data links:</span></span>
<span><span class="co">#&gt;   - spectra: 4063 sample(s) to 12082605 element(s).</span></span></code></pre></div>
<p>The data set includes in total 12082605 MS spectra for 4063
samples.</p>
<p>The size of the data object in memory:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2.7 Gb</span></span></code></pre></div>
<p>Note that this data object contains only the MS metadata (i.e.,
retention times, MS levels etc), but no MS peaks data (i.e.,
<em>m/z</em> and intensity values). With the default data representation
of the <em>Spectra</em> package, MS peaks data are only loaded upon
demand from the original data files.</p>
<div class="section level3">
<h3 id="overview-of-sample-and-experiment-metadata">Overview of sample and experiment metadata<a class="anchor" aria-label="anchor" href="#overview-of-sample-and-experiment-metadata"></a>
</h3>
<p>Various experimental and sample metadata are available for the data
set in the imported object’s <code><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData()</a></code>. These are
directly imported from the respective data files in
<em>MetaboLights</em>. The format of the imported variable names is
however not ideal for R-based data processing and we thus rename the
most relevant ones below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Select variable names with eventually interesting information</span></span>
<span><span class="va">scol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Factor Value[Gender]"</span>, <span class="st">"Factor Value[Age]"</span>,</span>
<span>          <span class="st">"Factor Value[Cluster effect]"</span>, <span class="st">"Factor Value[RMSD]"</span>,</span>
<span>          <span class="st">"Factor Value[Injection number]"</span>, <span class="st">"Factor Value[Spectrum type]"</span>,</span>
<span>          <span class="st">"Factor Value[Analysis date]"</span>, <span class="st">"Sample Name"</span><span class="op">)</span></span>
<span><span class="co">#' Define R-save names for these</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scol</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"cluster_effect"</span>, <span class="st">"rmsd"</span>, <span class="st">"injection_number"</span>,</span>
<span>                 <span class="st">"spectrum_type"</span>, <span class="st">"analysis_date"</span>, <span class="st">"sample_name"</span><span class="op">)</span></span>
<span><span class="co">#' Rename the variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">scol</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">scol</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Female   Male</span></span>
<span><span class="co">#&gt;   1747   2316</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parallel-processing-setup">Parallel processing setup<a class="anchor" aria-label="anchor" href="#parallel-processing-setup"></a>
</h3>
<p>Many functions from <em>xcms</em>, in particular the ones requiring
heavy calculations, support parallel processing. Processing functions
will split the data among these processes and perform the calculations
in parallel. While parallel processing can reduce the processing time,
it is important to note that it also requires all data that is being
processed to be in memory. There should thus always be a balance between
the number of parallel processes and the available/required memory
needed. See also section <em>Performance evaluation</em> below for more
information. In our example we use 8 CPUs in parallel.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default parallel processing setup.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Every function from <em>xcms</em> supporting parallel processing will
now use this default parallel processing setup.</p>
</div>
<div class="section level3">
<h3 id="initial-data-evaluation">Initial data evaluation<a class="anchor" aria-label="anchor" href="#initial-data-evaluation"></a>
</h3>
<p>Before preprocessing, we inspect the available LC-MS data and create
a base peak chromatogram (BPC). To reduce the processing time, we create
this BPC on 200 randomly selected samples.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Select 200 randomly selected samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">twins_rand</span> <span class="op">&lt;-</span> <span class="va">twins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We next create the BPC. With parameter <code>chunkSize = 8L</code> we
specify to load and process the MS peaks data of 8 MS data files at a
time. The <code>peakRAM()</code> function is used to track memory usage
and processing time. While the function will process the data of 8 files
at a time in parallel, there is no large performance gain for that,
because the processing consists of simply returning the maximum
intensity per spectrum.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Create the BPC for the data subset</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">bpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">chromatogram</a></span><span class="op">(</span><span class="va">twins_rand</span>, aggregationFun <span class="op">=</span> <span class="st">"max"</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The time and maximal (peak) memory used are:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"BPC extraction from 200 random samples."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for BPC extraction
from 200 random samples.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">4848</td>
<td align="center">4.877</td>
</tr></tbody>
</table>
<p>The BPC of these 200 random samples is shown below.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bpc</span>, col <span class="op">=</span> <span class="st">"#00000060"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-bpc-1.png" alt="plot of chunk bpc"><div class="figcaption">plot of chunk bpc</div>
</div>
<p>Based on the BPC above, we filter the data set to spectra measured
between 20 and 900 seconds. Such restriction of the data set also avoids
to perform the chromatographic peak detection in the part of the LC
where no compounds are expected to elute. We strongly recommend such
filtering before starting preprocessing to reduce running time.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/filterSpectra.html" class="external-link">filterSpectra</a></span><span class="op">(</span><span class="va">twins</span>, <span class="va">filterRt</span>, rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">900</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We next inspect the signal for selected lipids that have been
annotated in the original article (described in Figure S2 of the <a href="https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1004801" class="external-link">original
paper</a>). The retention times and <em>m/z</em> values for these
compounds were taken from the original publication.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Define m/z and retention times for annotated lipids</span></span>
<span><span class="va">kc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LysoPC_18:1"</span>, <span class="st">"LysoPC_18:2"</span>, <span class="st">"MG_18:2"</span><span class="op">)</span>,</span>
<span>    mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">522.356</span>, <span class="fl">520.341</span>, <span class="fl">337.269</span><span class="op">)</span>,</span>
<span>    rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">382.20</span>, <span class="fl">347.28</span>, <span class="fl">384.00</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">kc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="va">kc</span><span class="op">$</span><span class="va">rtmin</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">rt</span> <span class="op">-</span> <span class="fl">20</span></span>
<span><span class="va">kc</span><span class="op">$</span><span class="va">rtmax</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">rt</span> <span class="op">+</span> <span class="fl">20</span></span>
<span><span class="va">kc</span><span class="op">$</span><span class="va">mzmin</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">mz</span> <span class="op">-</span> <span class="fl">0.01</span></span>
<span><span class="va">kc</span><span class="op">$</span><span class="va">mzmax</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span><span class="va">mz</span> <span class="op">+</span> <span class="fl">0.01</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">kc</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Selected lipids that were annotated in the original article."</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Selected lipids that were annotated in the original
article.</caption>
<colgroup>
<col width="23%">
<col width="18%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center">name</th>
<th align="center">mz</th>
<th align="center">rt</th>
<th align="center">rtmin</th>
<th align="center">rtmax</th>
<th align="center">mzmin</th>
<th align="center">mzmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>LysoPC_18:1</strong></td>
<td align="center">LysoPC_18:1</td>
<td align="center">522.4</td>
<td align="center">382.2</td>
<td align="center">362.2</td>
<td align="center">402.2</td>
<td align="center">522.3</td>
<td align="center">522.4</td>
</tr>
<tr class="even">
<td align="center"><strong>LysoPC_18:2</strong></td>
<td align="center">LysoPC_18:2</td>
<td align="center">520.3</td>
<td align="center">347.3</td>
<td align="center">327.3</td>
<td align="center">367.3</td>
<td align="center">520.3</td>
<td align="center">520.4</td>
</tr>
<tr class="odd">
<td align="center"><strong>MG_18:2</strong></td>
<td align="center">MG_18:2</td>
<td align="center">337.3</td>
<td align="center">384</td>
<td align="center">364</td>
<td align="center">404</td>
<td align="center">337.3</td>
<td align="center">337.3</td>
</tr>
</tbody>
</table>
<p>We extract and plot the ion chromatograms (EIC) for these 3 compounds
from the 200 randomly selected samples.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract the ion chromatogram for the 3 compounds</span></span>
<span><span class="va">eics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">chromatogram</a></span><span class="op">(</span><span class="va">twins_rand</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">mzmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">mzmax</span><span class="op">)</span>,</span>
<span>                     rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">rtmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">rtmax</span><span class="op">)</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#' Plot the EICs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">eics</span>, col <span class="op">=</span> <span class="st">"#00000040"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-eic-random-1.png" alt="plot of chunk eic-random"><div class="figcaption">plot of chunk eic-random</div>
</div>
<p>Apparent retention time shifts are visible for all 3 compounds. We
can next evaluate chromatographic peak detection settings on these
example signals.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks-centWave.html" class="external-link">CentWaveParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                       peakwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                       snthresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                       mzCenterFun <span class="op">=</span> <span class="st">"wMean"</span>,</span>
<span>                       integrate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">met_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">eics</span>, param <span class="op">=</span> <span class="va">param</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">met_test</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;            mz   mzmin   mzmax      rt   rtmin   rtmax      into       intb</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 383.178 375.894 388.319 2329316.3 1691671.50</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.749 375.894 387.890 2109446.7 1535929.04</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.318 375.034 387.031 2393436.5 1751258.46</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 370.321 363.636 375.034  434015.4   74434.92</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.747 376.321 388.317 2208231.7 1624551.74</span></span>
<span><span class="co">#&gt; mzmin 522.356 522.346 522.366 382.318 374.606 387.031 2392099.1 1752668.52</span></span>
<span><span class="co">#&gt;            maxo sn row column</span></span>
<span><span class="co">#&gt; mzmin 505062.25  5   1      1</span></span>
<span><span class="co">#&gt; mzmin 469037.25  5   1      2</span></span>
<span><span class="co">#&gt; mzmin 527234.00  5   1      3</span></span>
<span><span class="co">#&gt; mzmin  99709.62  0   1      3</span></span>
<span><span class="co">#&gt; mzmin 476111.50  5   1      4</span></span>
<span><span class="co">#&gt; mzmin 544067.50  5   1      5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">met_test</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-eic-random-cp-1.png" alt="plot of chunk eic-random-cp"><div class="figcaption">plot of chunk eic-random-cp</div>
</div>
<p>Chromatographic peaks were detected in all cases, but due to the
large number of samples investigated it is not easy to evaluate the
results properly. We thus create the same plot for only the first 5
samples.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">met_test</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-eic-random-cp-5-1.png" alt="plot of chunk eic-random-cp-5"><div class="figcaption">plot of chunk eic-random-cp-5</div>
</div>
<p>The large peak was thus correctly identified. Also the lower
abundance peak would be detected if the <code>snthresh</code> would be
reduced for the peak detection in the EIC signal. Noise estimation is
difficult for peak detection in extracted ion signals, as most of the
chromatogram contains actual signal from the ion. This is different for
the preprocessing on the full data set performed in the next section as
much more <em>real</em> background signal is present in the full MS data
to properly estimate the noise.</p>
</div>
<div class="section level3">
<h3 id="preprocessing">Preprocessing<a class="anchor" aria-label="anchor" href="#preprocessing"></a>
</h3>
<p>We next perform the preprocessing of the LC-MS data. Settings of the
individual processing steps were taken from the original <a href="https://github.com/andgan/metabolomics_pipeline" class="external-link">data analysis R
script</a> and adapted to the new <em>xcms</em> interface.</p>
<p>At first we perform the chromatographic peak detection using the
<em>centWave</em> method. With the parameter <code>hdf5File</code> we
define the name (and eventually path) for a file to keep the
preprocessing results. Information on identified chromatographic peaks
and results from later preprocessing steps will then be stored into this
file. The HDF5 file format guarantees efficient storage, and retrieval,
of these results or subsets thereof. The memory footprint of this new
result object is thus very small which is ideal for the processing of
very large data sets, also on conventional computing infrastructure
(e.g. laptop). With <code>chunkSize = 8</code> we define to load and
process the MS data of 8 data files at a time. Peak detection is then
performed in parallel on 8 CPUs using our predefined default parallel
processing setup.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cwp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks-centWave.html" class="external-link">CentWaveParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                     peakwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                     prefilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>                     snthresh <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     mzCenterFun <span class="op">=</span> <span class="st">"wMean"</span>,</span>
<span>                     integrate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"twins.h5"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"twins.h5"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                            hdf5File <span class="op">=</span> <span class="st">"twins.h5"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Memory usage and time elapsed for this processing step where:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"the chromatographic peak detection step on the"</span>,</span>
<span>                     <span class="st">" full data."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for the
chromatographic peak detection step on the full data.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">8618</td>
<td align="center">422.1</td>
</tr></tbody>
</table>
<p>As a result, the <code><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks()</a></code> function returned an
object of type <code>XcmsExperimentHdf5</code>, which, as described
above, stored all preprocessing results on-disk in a file in HDF5
format. The size of this result object in memory is thus not much larger
than the original object representing the MS data:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.8 Gb</span></span></code></pre></div>
<p>The identified chromatographic peaks are stored as a numeric matrix.
Depending on the size of the experiment and MS data files as well as the
used peak detection settings, this matrix can also be very large and use
a big part of the main memory, which can significantly slow down
subsequent analysis steps. Below we load this data matrix into memory to
evaluate its size.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Load the chromatographic peak detection results and</span></span>
<span><span class="co">#' get its size.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>units <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3.4 Gb</span></span></code></pre></div>
<p>For the present data set and the used settings, the size of the
chromatographic peak matrix seems manageable also for regular computers.
However, having this data object all the time in memory can have
negative impact on processing efficiency and in the worst case have R
running out of memory along the further analysis.</p>
<p>Below we count the number of chromatographic peaks detected per
sample and determine also their total sum. Here we take advantage of the
possibility to load only selected columns of the chromatographic peak
matrix, which will reduce the memory need for the present calculation.
Also, we use <code>bySample = TRUE</code> which returns the result as a
<code>list</code> of chromatographic peak matrices. The length of the
list is equal to the number of samples and each element is the
chromatographic peak matrix of one sample.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Load the "into" column from the chrom peak matrix</span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, columns <span class="op">=</span> <span class="st">"into"</span>, bySample <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' The distribution of the number of peaks counts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">pc</span>, <span class="va">nrow</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     0%    25%    50%    75%   100%</span></span>
<span><span class="co">#&gt; 3344.0 4919.5 5511.0 6124.0 9167.0</span></span></code></pre></div>
<p>Between 5000 and 6000 chromatographic peaks have been detected per
sample. The total number of peaks is:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">pc</span>, <span class="va">nrow</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 22568648</span></span></code></pre></div>
<p>Next we perform the <em>peak refinement</em>. This step helps to
reduce common peak detection artifacts, such as duplicated peaks,
overlapping peaks or artificially split peaks. Again, we process the
data in chunks of 8 data files at a time to keep memory usage manageable
for the used computer system.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Perform peak refinement</span></span>
<span><span class="va">mnpp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">MergeNeighboringPeaksParam</a></span><span class="op">(</span>expandRt <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Memory usage and time elapsed for this processing step where:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [hours]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"the chromatographic peak refinement."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for the
chromatographic peak refinement.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [hours]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">5316</td>
<td align="center">2.926</td>
</tr></tbody>
</table>
<p>For retention time alignment we will use the <em>peak groups</em>
method, that adjusts retention time shifts between samples based on the
retention times of common compounds present in most samples (the so
called <em>anchor peaks</em>). We thus run next an initial
correspondence analysis (with relaxed settings for retention time
differences) in order to define these.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Define settings for an initial correspondence analysis:</span></span>
<span><span class="co">#' require anchor peaks to be present in 70% of samples, but use a</span></span>
<span><span class="co">#' larger bw to allow rt shifts</span></span>
<span><span class="va">pdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        minFraction <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>                        binSize <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                        ppm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        bw <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"a correspondence analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for a correspondence
analysis.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">5316</td>
<td align="center">1.525</td>
</tr></tbody>
</table>
<p>We can next perform the retention time alignment using the <em>peak
groups</em> method.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">PeakGroupsParam</a></span><span class="op">(</span>minFraction <span class="op">=</span> <span class="fl">0.8</span>, extraPeaks <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                       span <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#' Perform the alignment</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">adjustRtime</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">pgp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"the retention time alignment analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for the retention
time alignment analysis.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">2157</td>
<td align="center">1.66</td>
</tr></tbody>
</table>
<p>We evaluate the performance of the alignment on EICs for the 3 known
compounds in 200 random samples.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Select 200 random samples and extract ion chromatograms for the 3</span></span>
<span><span class="co">#' annotated lipids. We reuse the same random seed to choose the same</span></span>
<span><span class="co">#' random samples selected before. Note that we use `keepAdjustedRtime = TRUE`</span></span>
<span><span class="co">#' to avoid the retention times being restored to the original values.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">twins_rand</span> <span class="op">&lt;-</span> <span class="va">twins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span>, keepAdjustedRtime <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract the ion chromatogram for the 3 compounds</span></span>
<span><span class="va">eics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">chromatogram</a></span><span class="op">(</span><span class="va">twins_rand</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">mzmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">mzmax</span><span class="op">)</span>,</span>
<span>                     rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">rtmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">rtmax</span><span class="op">)</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#' Plot the EICs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">eics</span>, col <span class="op">=</span> <span class="st">"#00000020"</span>, peakBg <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-eic-random-align-1.png" alt="plot of chunk eic-random-align"><div class="figcaption">plot of chunk eic-random-align</div>
</div>
<p>The EICs are nicely aligned.</p>
<p>We perform now the final correspondence analysis to match aligned
chromatographic peaks across samples and define the <em>LC-MS
features</em>. We reduce <code>minFraction</code> parameter to also
define features if chromatographic peaks were only present in 30% of the
samples and use a more stringent <code>bw</code> parameter.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        minFraction <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                        binSize <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                        ppm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        bw <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"the final correspondence analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for the final
correspondence analysis.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">5242</td>
<td align="center">2.451</td>
</tr></tbody>
</table>
<p>We also evaluate whether the correspondence could correctly define
features for the 3 selected lipids.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">twins_rand</span> <span class="op">&lt;-</span> <span class="va">twins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>                    keepAdjustedRtime <span class="op">=</span> <span class="cn">TRUE</span>, keepFeatures <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span></span>
<span><span class="va">eics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">chromatogram</a></span><span class="op">(</span><span class="va">twins_rand</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">mzmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">mzmax</span><span class="op">)</span>,</span>
<span>                     rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kc</span><span class="op">$</span><span class="va">rtmin</span>, <span class="va">kc</span><span class="op">$</span><span class="va">rtmax</span><span class="op">)</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p>Correspondence was able to correctly assign the chromatographic peaks
left of the center peaks into a separate feature.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/plotChromPeakDensity.html" class="external-link">plotChromPeakDensity</a></span><span class="op">(</span><span class="va">eics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-feature-1-1.png" alt="plot of chunk feature-1"><div class="figcaption">plot of chunk feature-1</div>
</div>
<p>Also for the second example, the chromatographic peaks were assigned
to two separate features.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/plotChromPeakDensity.html" class="external-link">plotChromPeakDensity</a></span><span class="op">(</span><span class="va">eics</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-feature-2-1.png" alt="plot of chunk feature-2"><div class="figcaption">plot of chunk feature-2</div>
</div>
<p>Finally, also for the last example chromatographic peaks were
correctly assigned to features.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/plotChromPeakDensity.html" class="external-link">plotChromPeakDensity</a></span><span class="op">(</span><span class="va">eics</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-feature-3-1.png" alt="plot of chunk feature-3"><div class="figcaption">plot of chunk feature-3</div>
</div>
<p>Below we extract the feature abundances for all features in all
samples and count the total number of defined features. The
<code><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-peak-grouping-results.html" class="external-link">featureValues()</a></code> function collects and extracts this
information from the associated HDF5 file used to store the
correspondence results.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract the feature abundances for all features in all samples</span></span>
<span><span class="va">fvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-peak-grouping-results.html" class="external-link">featureValues</a></span><span class="op">(</span><span class="va">twins</span>, value <span class="op">=</span> <span class="st">"into"</span>, method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fvals</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4981</span></span></code></pre></div>
<p>The total number of missing values in this data matrix is:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">fvals</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6690736</span></span></code></pre></div>
<p>As a last step we therefore perform the gap-filling to
<em>rescue</em> abundances for features for which in some samples no
chromatographic peak was detected (and for which hence a missing value
is reported). Here we can again benefit from chunk-wise parallel
processing.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Perform the gap filling</span></span>
<span><span class="va">cpap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">ChromPeakAreaParam</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">twins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">twins</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [hours]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"gap filling."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for gap
filling.</caption>
<thead><tr class="header">
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [hours]</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">6737</td>
<td align="center">2.737</td>
</tr></tbody>
</table>
<p>The number of missing values after gap filling:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-peak-grouping-results.html" class="external-link">featureValues</a></span><span class="op">(</span><span class="va">twins</span>, value <span class="op">=</span> <span class="st">"into"</span>, method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 61443</span></span></code></pre></div>
<p>Since all preprocessing results are stored in an HDF5 file and hence
on-disk, the size of the final results object is not larger than the
size of the initial data object representing the MS data of the
experiment. Note that this size could be further reduced (and eventually
overall performance improved) by storing the MS data in a SQL database
and representing/interfacing it with a <code>Spectra</code> backend from
the <em><a href="https://bioconductor.org/packages/3.21/MsBackendSql" class="external-link">MsBackendSql</a></em>
package (see the last section in this vignette for more
information).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.9 Gb</span></span></code></pre></div>
<p>The results from the preprocessing could now be converted to a
<code>SummarizedExperiment</code> object using the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">quantify()</a></code> function to continue the analysis e.g. by
performing further data exploration, normalization or statistical data
analysis.</p>
</div>
</div>
<div class="section level2">
<h2 id="performance-evaluation">Performance evaluation<a class="anchor" aria-label="anchor" href="#performance-evaluation"></a>
</h2>
<p>In this section we evaluate performance and memory requirements of
<em>xcms</em> for data preprocessing. R’s copy-on-change strategy can be
a bottleneck, in particular for very large data sets as data objects
(and hence preprocessing results) are copied temporarily during a data
analysis. We compare memory usage for the default
<code>XcmsExperiment</code> object as well as the new
<code>XcmsExperimentHdf5</code> result object and evaluate scalability
of the preprocessing by distributing the load to separate CPUs. In
contract to the <code>XcmsExperiment</code> object, the
<code>XcmsExperimentHdf5</code> object keeps all preprocessing results
<em>on-disk</em> in an HDF5 file reducing thus the memory footprint.
Below we create a subset of the data consisting of 100 randomly selected
files.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tsub</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">twins</span>, <span class="st">"MsExperiment"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">twins</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We perform chromatographic peak detection on this subset for
different configurations:</p>
<ul>
<li>Peak detection using the default <code>XcmsExperiment</code> result
object.</li>
<li>Peak detection using the <code>XcmsExperimentHdf5</code> result
object.</li>
<li>Peak detection using 1, 2, 4 and 8 CPUs for both result
objects.</li>
</ul>
<p>We use a <code>chunkSize = 8</code> for all these setups, which will
load the MS data for 8 data files into memory. The time and memory usage
to access this data is:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/tpq/peakRAM" class="external-link">peakRAM</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">peakRAM</span><span class="op">(</span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectra</a></span><span class="op">(</span><span class="va">tsub</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        Function_Call Elapsed_Time_sec Total_RAM_Used_MiB</span></span>
<span><span class="co">#&gt; 1 tmp&lt;-peaksData(spectra(tsub[1:8]))            5.833             1922.9</span></span>
<span><span class="co">#&gt;   Peak_RAM_Used_MiB</span></span>
<span><span class="co">#&gt; 1            3864.8</span></span></code></pre></div>
<p>And the memory used of the resulting MS data:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"GB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.9 Gb</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<p>We next execute the performance tests. To use the new
<code>XcmsExperimentHdf5</code>, we need to specify the path and file
name of the HDF5 file where the results should be stored to.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">cwp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks-centWave.html" class="external-link">CentWaveParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                     peakwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>                     prefilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>                     snthresh <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     mzCenterFun <span class="op">=</span> <span class="st">"wMean"</span>,</span>
<span>                     integrate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Eventually remove the result HDF5 object if present</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"tres.h5"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"tres.h5"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Perform the comparison</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">tres_h5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                              BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span>, hdf5File <span class="op">=</span> <span class="st">"tres.h5"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, hdf5File <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, hdf5File <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">tsub</span>, param <span class="op">=</span> <span class="va">cwp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span>, hdf5File <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><em>peakRAM</em> can not correctly monitor the memory usage for
multi-core processing, thus we evaluate memory usage only for the
<em>serial</em> processing setup.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"chromatographic peak detection using different number "</span>,</span>
<span>                     <span class="st">"of CPUs. Data was loaded and processed in chunks of "</span>,</span>
<span>                     <span class="st">"8 data files."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for chromatographic
peak detection using different number of CPUs. Data was loaded and
processed in chunks of 8 data files.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">6691</td>
<td align="center">40.97</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">2</td>
<td align="center">6627</td>
<td align="center">23.88</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">4</td>
<td align="center">6627</td>
<td align="center">14.94</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">8</td>
<td align="center">6627</td>
<td align="center">11.95</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">6627</td>
<td align="center">41.44</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">2</td>
<td align="center">6627</td>
<td align="center">24.21</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">4</td>
<td align="center">6627</td>
<td align="center">15.3</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">8</td>
<td align="center">6627</td>
<td align="center">12.37</td>
</tr>
</tbody>
</table>
<p>The memory demand is dependent on the <code>chunkSize</code>
parameter, i.e., the number of files (samples) from which the MS data is
loaded and processed at a time. The peak RAM usage for
<code>chunkSize = 8</code> is, for the present data set, about twice as
large as the size of the respective MS data in memory. The processing
time is reduced with an increase in the number of CPUs used, but this
relationship is not linear. This is most likely due to the overhead in
data splitting and distribution to the individual calculation nodes as
well as the result collection and their merging/export.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"CPUs"</span><span class="op">]</span>, <span class="va">tmp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"Processing time [min]"</span><span class="op">]</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"#ff000080"</span>, xlab <span class="op">=</span> <span class="st">"CPUs"</span>, ylab <span class="op">=</span> <span class="st">"Time [min]"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="st">"CPUs"</span><span class="op">]</span>, <span class="va">tmp</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="st">"Processing time [min]"</span><span class="op">]</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"#0000ff80"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ff000080"</span>, <span class="st">"#0000ff80"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Memory"</span>, <span class="st">"HDF5 file"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/large-scale-performance-1.png" alt="plot of chunk performance"><div class="figcaption">plot of chunk performance</div>
</div>
<p>The largest performance gain is between serial processing and
parallel processing with two CPUs. Importantly, the performance of
keeping the results in memory (for the <code>XcmsExperiment</code>
result object) or storing them to a HDF5 file (for the
<code>XcmsExperimentHdf5</code> file) is comparable.</p>
<p>We next evaluate the performance of the peak refinement step for the
different setups re-using the parameter object from the peak refinement
on the full data. Processing an <code>XcmsExperimentHdf5</code> object
will overwrite the results in the associated HDF5 files. To perform the
peak refinement on the same initial data we thus need to create copies
of the original HDF5 file for each configuration.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">mnpp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">MergeNeighboringPeaksParam</a></span><span class="op">(</span>expandRt <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Create copies of the original peak detection results</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">tres_h5</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">tres_h5</span><span class="op">@</span><span class="va">hdf5_file</span>, <span class="va">tf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">t1</span><span class="op">@</span><span class="va">hdf5_file</span> <span class="op">&lt;-</span> <span class="va">tf</span></span>
<span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="va">tres_h5</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">tres_h5</span><span class="op">@</span><span class="va">hdf5_file</span>, <span class="va">tf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">t2</span><span class="op">@</span><span class="va">hdf5_file</span> <span class="op">&lt;-</span> <span class="va">tf</span></span>
<span></span>
<span><span class="va">t4</span> <span class="op">&lt;-</span> <span class="va">tres_h5</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">tres_h5</span><span class="op">@</span><span class="va">hdf5_file</span>, <span class="va">tf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">t4</span><span class="op">@</span><span class="va">hdf5_file</span> <span class="op">&lt;-</span> <span class="va">tf</span></span>
<span></span>
<span><span class="va">t8</span> <span class="op">&lt;-</span> <span class="va">tres_h5</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">tres_h5</span><span class="op">@</span><span class="va">hdf5_file</span>, <span class="va">tf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">t8</span><span class="op">@</span><span class="va">hdf5_file</span> <span class="op">&lt;-</span> <span class="va">tf</span></span>
<span></span>
<span><span class="co">#' Run peak refinement with different configurations</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">tres</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                               BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">tres</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">tres</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">tres</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">t1</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">t2</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">t4</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span><span class="va">t8</span>, param <span class="op">=</span> <span class="va">mnpp</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"chromatographic peak refinement using different number "</span>,</span>
<span>                     <span class="st">"of CPUs. Data was loaded and processed in chunks of "</span>,</span>
<span>                     <span class="st">"8 data files."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for chromatographic
peak refinement using different number of CPUs. Data was loaded and
processed in chunks of 8 data files.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">6627</td>
<td align="center">6.408</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">2</td>
<td align="center">6571</td>
<td align="center">5.147</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">4</td>
<td align="center">6570</td>
<td align="center">4.267</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">8</td>
<td align="center">6570</td>
<td align="center">4.226</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">6570</td>
<td align="center">6.592</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">2</td>
<td align="center">6566</td>
<td align="center">5.22</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">4</td>
<td align="center">6566</td>
<td align="center">4.336</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">8</td>
<td align="center">6566</td>
<td align="center">4.65</td>
</tr>
</tbody>
</table>
<p>The maximum memory usage is the same for all settings and is again
depending on the number of data files from which raw data is imported.
The processing time is not reduced considerably by the number of CPUs.
This however depends also on the data set and the number of candidate
peaks for merging. Processing times are also similar between the
in-memory and on-disk results of the <code>XcmsExperiment</code> and
<code>XcmsExperimentHdf5</code> objects.</p>
<p>Next we evaluate the performance of a correspondence analysis with
the <em>peak density</em> method. This method uses only the
<code><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks()</a></code> matrix for the analysis and does thus not
support the <code>chunkSize</code> parameter nor does it support
parallel processing. We thus only compare the performance of in-memory
and on-disk results below.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">pdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tsub</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        minFraction <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                        binSize <span class="op">=</span> <span class="fl">0.01</span>, ppm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        bw <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Evaluate performance of the correspondence analysis</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span>,</span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/groupChromPeaks.html" class="external-link">groupChromPeaks</a></span><span class="op">(</span><span class="va">t1</span>, param <span class="op">=</span> <span class="va">pdp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [sec]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"correspondence analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for correspondence
analysis.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [sec]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">2738</td>
<td align="center">27.19</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">2720</td>
<td align="center">28.36</td>
</tr>
</tbody>
</table>
<p>The performance and memory demand is similar for the two result
objects.</p>
<p>Next we evaluate the performance of the retention time alignment step
using the <em>peak groups</em> approach. This method relies on the peak
detection and correspondence results and does not support parallel
processing.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">pgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">PeakGroupsParam</a></span><span class="op">(</span>minFraction <span class="op">=</span> <span class="fl">0.9</span>, extraPeaks <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                       span <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Evaluate performance of the correspondence analysis</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">adjustRtime</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">pgp</span><span class="op">)</span>,</span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/adjustRtime.html" class="external-link">adjustRtime</a></span><span class="op">(</span><span class="va">t1</span>, param <span class="op">=</span> <span class="va">pgp</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [sec]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"retention time alignment analysis."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for retention time
alignment analysis.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [sec]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">2738</td>
<td align="center">27.19</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">2720</td>
<td align="center">28.36</td>
</tr>
</tbody>
</table>
<p>Processing time is very similar for both result objects, but the
memory requirement is much lower for the <code>XcmsExperimentHdf5</code>
object.</p>
<p>Finally we evaluate the performance of the gap-filling step. This
method requires access to the full MS data and can thus again be
configured with the <code>chunkSize</code> parameter and different
parallel processing setups.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Settings</span></span>
<span><span class="va">cpap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">ChromPeakAreaParam</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">peakRAM</span><span class="op">(</span></span>
<span>    <span class="va">tres_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                             BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">tres_2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">t1</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                         BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">t2</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                         BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">t4</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                         BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">t8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/fillChromPeaks.html" class="external-link">fillChromPeaks</a></span><span class="op">(</span><span class="va">t8</span>, param <span class="op">=</span> <span class="va">cpap</span>, chunkSize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                         BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    `Result object` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"XcmsExperiment"</span>, <span class="st">"XcmsExperimentHdf5"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    `CPUs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    `Peak RAM [MiB]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Peak_RAM_Used_MiB</span>,</span>
<span>    `Processing time [min]` <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">Elapsed_Time_sec</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span></span>
<span>    <span class="va">tmp</span>, style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.table <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Peak RAM memory usage and processing time for "</span>,</span>
<span>                     <span class="st">"gap filling using different number "</span>,</span>
<span>                     <span class="st">"of CPUs. Data was loaded and processed in chunks of "</span>,</span>
<span>                     <span class="st">"8 data files."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Peak RAM memory usage and processing time for gap filling using
different number of CPUs. Data was loaded and processed in chunks of 8
data files.</caption>
<thead><tr class="header">
<th align="center">Result object</th>
<th align="center">CPUs</th>
<th align="center">Peak RAM [MiB]</th>
<th align="center">Processing time [min]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">1</td>
<td align="center">6567</td>
<td align="center">5.578</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">2</td>
<td align="center">6541</td>
<td align="center">2.407</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperiment</td>
<td align="center">4</td>
<td align="center">6541</td>
<td align="center">2.457</td>
</tr>
<tr class="even">
<td align="center">XcmsExperiment</td>
<td align="center">8</td>
<td align="center">6541</td>
<td align="center">2.59</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">1</td>
<td align="center">6541</td>
<td align="center">5.861</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">2</td>
<td align="center">6541</td>
<td align="center">4.851</td>
</tr>
<tr class="odd">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">4</td>
<td align="center">6541</td>
<td align="center">4.227</td>
</tr>
<tr class="even">
<td align="center">XcmsExperimentHdf5</td>
<td align="center">8</td>
<td align="center">6541</td>
<td align="center">4.99</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="details-of-the-software-structure-and-data-flow">Details of the software structure and data flow<a class="anchor" aria-label="anchor" href="#details-of-the-software-structure-and-data-flow"></a>
</h3>
<p>To reduce memory demand, most processing steps are applied to
<em>chunks</em> of the data at a time. Thus, only the MS data for the
currently processed chunks are realized in memory. By using the <em><a href="https://bioconductor.org/packages/3.21/Spectra" class="external-link">Spectra</a></em>
package to represent and provide the MS data, <em>xcms</em> now also
benefits from dedicated <code>Spectra</code> data <em>backends</em> that
e.g. retrieve the MS data on-the-fly from the original MS data files
(<code>MsBackendMzR</code>) or from an SQL database (using backends from
the <code>r Biocpkg("MsBackendSql")</code> package). These alternative
data representations are seamlessly integrated with <em>xcms</em> and
increase flexibility while reducing memory demand.</p>
<p>The <code>XcmsExperiment</code> result object keeps, similar to the
older result objects from <em>xcms</em>, all preprocessing results in
memory, the chromatographic peak detection results
(<code><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks()</a></code> matrix) in a large numeric matrix and the
correspondence results (<code><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">featureDefinitions()</a></code>) in a data
frame. Accessing these data is thus fast, but, depending on the size of
the experiment, they can also be very large eventually blocking a large
part of the system’s main memory. Further, for some additional analysis
steps, these tables might need to be further processed, e.g. split by
sample, which can result in (at least temporary) additional copies of
the data in memory (which can be further complicated by R’s
copy-on-change strategy). Memory usage can thus, unexpectedly to the
user, exceed the available system memory.</p>
<p>The new <code>XcmsExperimentHdf5</code> was designed to address this
issue by storing all preprocessing results in a HDF5 file on disk,
keeping thus a very lean memory footprint. Thus, the above described
chunk-wise processing of <em>xcms</em> will also only load preprocessing
results from the currently processed chunk into memory. Importing
preprocessing results from the HDF5 file comes with a little overhead,
but the functions have been optimized for import of subsets of data at a
time.</p>
</div>
<div class="section level3">
<h3 id="summary-and-guidance">Summary and guidance<a class="anchor" aria-label="anchor" href="#summary-and-guidance"></a>
</h3>
<ul>
<li><p>Use the parameter <code>chunkSize</code> to specify the number of
samples/files that should be processed at a time. Ensure to set this
value according to the system’s main memory. The MS data of samples from
one chunk should not exceed the still available (!) system
memory.</p></li>
<li><p>Parallel processing helps reduce processing time, but does not
scale linearly, since parallel processing involves also distribution of
data to, and collection of results from, the individual processing
nodes.</p></li>
<li><p>For the present analysis, a big part of computation time was
spent on the needed <em>on-the-fly</em> import of the MS data from the
original data files. CDF files might not be the most efficient data
storage container for such on-demand data retrieval. Storing the
original MS data in an SQL database (either SQLite or MariaDB/MySQL) can
further improve performance. See the <em><a href="https://bioconductor.org/packages/3.21/MsbackendSql" class="external-link">MsbackendSql</a></em>
for details. The code that could be used to store the full MS data of
the current experiment into a SQLite database is shown below:</p></li>
</ul>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Create a SQLite database</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"twins.sqlite"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MsBackendSql</span><span class="op">)</span></span>
<span><span class="va">twins_db</span> <span class="op">&lt;-</span> <span class="va">twins</span></span>
<span></span>
<span><span class="co">#' Save the full MS data into this database</span></span>
<span><span class="va">twins_db</span><span class="op">@</span><span class="va">spectra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">setBackend</a></span><span class="op">(</span><span class="va">twins_db</span><span class="op">@</span><span class="va">spectra</span>, <span class="fu">MsBackendSql</span><span class="op">(</span><span class="op">)</span>, dbcon <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<p>The R code was run on:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fri Apr 18 10:43:40 2025"</span></span></code></pre></div>
<p>Information on the computer system:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/csgillespie/benchmarkme" class="external-link">benchmarkme</a></span><span class="op">)</span></span>
<span><span class="fu">get_cpu</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $vendor_id</span></span>
<span><span class="co">#&gt; [1] "GenuineIntel"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $model_name</span></span>
<span><span class="co">#&gt; [1] "13th Gen Intel(R) Core(TM) i7-1370P"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $no_of_cores</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span><span class="fu">get_ram</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 67.1 GB</span></span></code></pre></div>
<p>Information on the R session:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.0 (2025-04-11)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Arch Linux</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /home/jo/R/R-4.5.0/lib64/R/lib/libRblas.so</span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/liblapack.so.3.12.0  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C</span></span>
<span><span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8</span></span>
<span><span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8</span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C</span></span>
<span><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C</span></span>
<span><span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; time zone: Europe/Rome</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods</span></span>
<span><span class="co">#&gt; [8] base</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] benchmarkme_1.0.8           pander_0.6.6</span></span>
<span><span class="co">#&gt;  [3] peakRAM_1.0.2               xcms_4.7.1</span></span>
<span><span class="co">#&gt;  [5] MsIO_0.0.9                  MsExperiment_1.10.0</span></span>
<span><span class="co">#&gt;  [7] ProtGenerics_1.40.0         MsBackendMetaboLights_1.2.0</span></span>
<span><span class="co">#&gt;  [9] Spectra_1.18.0              BiocParallel_1.42.0</span></span>
<span><span class="co">#&gt; [11] S4Vectors_0.46.0            BiocGenerics_0.54.0</span></span>
<span><span class="co">#&gt; [13] generics_0.1.3              BiocStyle_2.36.0</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] DBI_1.2.3                   rlang_1.1.6</span></span>
<span><span class="co">#&gt;   [3] magrittr_2.0.3              clue_0.3-66</span></span>
<span><span class="co">#&gt;   [5] MassSpecWavelet_1.74.0      matrixStats_1.5.0</span></span>
<span><span class="co">#&gt;   [7] compiler_4.5.0              RSQLite_2.3.9</span></span>
<span><span class="co">#&gt;   [9] vctrs_0.6.5                 reshape2_1.4.4</span></span>
<span><span class="co">#&gt;  [11] stringr_1.5.1               pkgconfig_2.0.3</span></span>
<span><span class="co">#&gt;  [13] MetaboCoreUtils_1.16.0      crayon_1.5.3</span></span>
<span><span class="co">#&gt;  [15] fastmap_1.2.0               dbplyr_2.5.0</span></span>
<span><span class="co">#&gt;  [17] XVector_0.48.0              rmarkdown_2.29</span></span>
<span><span class="co">#&gt;  [19] preprocessCore_1.70.0       UCSC.utils_1.4.0</span></span>
<span><span class="co">#&gt;  [21] purrr_1.0.4                 bit_4.6.0</span></span>
<span><span class="co">#&gt;  [23] xfun_0.52                   MultiAssayExperiment_1.34.0</span></span>
<span><span class="co">#&gt;  [25] cachem_1.1.0                GenomeInfoDb_1.44.0</span></span>
<span><span class="co">#&gt;  [27] jsonlite_2.0.0              progress_1.2.3</span></span>
<span><span class="co">#&gt;  [29] blob_1.2.4                  rhdf5filters_1.20.0</span></span>
<span><span class="co">#&gt;  [31] DelayedArray_0.34.0         Rhdf5lib_1.30.0</span></span>
<span><span class="co">#&gt;  [33] parallel_4.5.0              prettyunits_1.2.0</span></span>
<span><span class="co">#&gt;  [35] cluster_2.1.8.1             R6_2.6.1</span></span>
<span><span class="co">#&gt;  [37] stringi_1.8.7               RColorBrewer_1.1-3</span></span>
<span><span class="co">#&gt;  [39] limma_3.64.0                GenomicRanges_1.60.0</span></span>
<span><span class="co">#&gt;  [41] iterators_1.0.14            Rcpp_1.0.14</span></span>
<span><span class="co">#&gt;  [43] SummarizedExperiment_1.38.0 knitr_1.50</span></span>
<span><span class="co">#&gt;  [45] IRanges_2.42.0              BiocBaseUtils_1.10.0</span></span>
<span><span class="co">#&gt;  [47] Matrix_1.7-3                igraph_2.1.4</span></span>
<span><span class="co">#&gt;  [49] tidyselect_1.2.1            abind_1.4-8</span></span>
<span><span class="co">#&gt;  [51] yaml_2.3.10                 doParallel_1.0.17</span></span>
<span><span class="co">#&gt;  [53] affy_1.86.0                 codetools_0.2-20</span></span>
<span><span class="co">#&gt;  [55] curl_6.2.2                  lattice_0.22-7</span></span>
<span><span class="co">#&gt;  [57] tibble_3.2.1                plyr_1.8.9</span></span>
<span><span class="co">#&gt;  [59] withr_3.0.2                 Biobase_2.68.0</span></span>
<span><span class="co">#&gt;  [61] benchmarkmeData_1.0.4       evaluate_1.0.3</span></span>
<span><span class="co">#&gt;  [63] BiocFileCache_2.16.0        alabaster.schemas_1.8.0</span></span>
<span><span class="co">#&gt;  [65] affyio_1.78.0               pillar_1.10.2</span></span>
<span><span class="co">#&gt;  [67] BiocManager_1.30.25         filelock_1.0.3</span></span>
<span><span class="co">#&gt;  [69] MatrixGenerics_1.20.0       foreach_1.5.2</span></span>
<span><span class="co">#&gt;  [71] MALDIquant_1.22.3           MSnbase_2.34.0</span></span>
<span><span class="co">#&gt;  [73] ncdf4_1.24                  ggplot2_3.5.2</span></span>
<span><span class="co">#&gt;  [75] hms_1.1.3                   munsell_0.5.1</span></span>
<span><span class="co">#&gt;  [77] scales_1.3.0                alabaster.base_1.8.0</span></span>
<span><span class="co">#&gt;  [79] glue_1.8.0                  MsFeatures_1.16.0</span></span>
<span><span class="co">#&gt;  [81] lazyeval_0.2.2              tools_4.5.0</span></span>
<span><span class="co">#&gt;  [83] mzID_1.46.0                 data.table_1.17.0</span></span>
<span><span class="co">#&gt;  [85] vsn_3.76.0                  QFeatures_1.18.0</span></span>
<span><span class="co">#&gt;  [87] mzR_2.42.0                  XML_3.99-0.18</span></span>
<span><span class="co">#&gt;  [89] fs_1.6.6                    rhdf5_2.52.0</span></span>
<span><span class="co">#&gt;  [91] grid_4.5.0                  impute_1.82.0</span></span>
<span><span class="co">#&gt;  [93] tidyr_1.3.1                 MsCoreUtils_1.20.0</span></span>
<span><span class="co">#&gt;  [95] colorspace_2.1-1            GenomeInfoDbData_1.2.14</span></span>
<span><span class="co">#&gt;  [97] PSMatch_1.12.0              cli_3.6.4</span></span>
<span><span class="co">#&gt;  [99] S4Arrays_1.8.0              dplyr_1.1.4</span></span>
<span><span class="co">#&gt; [101] AnnotationFilter_1.32.0     pcaMethods_2.0.0</span></span>
<span><span class="co">#&gt; [103] gtable_0.3.6                digest_0.6.37</span></span>
<span><span class="co">#&gt; [105] SparseArray_1.8.0           memoise_2.0.1</span></span>
<span><span class="co">#&gt; [107] htmltools_0.5.8.1           lifecycle_1.0.4</span></span>
<span><span class="co">#&gt; [109] httr_1.4.7                  statmod_1.5.0</span></span>
<span><span class="co">#&gt; [111] bit64_4.6.0-1               MASS_7.3-65</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philippine Louail, Johannes Rainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
